{"version":3,"sources":["components/CreateSteps/P5CustomForwards/P5CustomForwards.module.css","components/CreateNavigator/CreateNavigator.module.css","components/CreateSteps/P6Broadcast/P6Broadcast.module.css","helpers/bns/constants.tsx","helpers/bns/calcTx.tsx","components/AboutContent/AboutContent.module.css","components/CreateSteps/P1RestoreOrBackup/P1RestoreOrBackup.module.css","components/CreateSteps/P4ActionChoice/P4ActionChoice.module.css","components/CreateSteps/P3DomainAndWallet/P3DomainAndWallet.module.css","components/SearchResults/SearchResults.module.css","helpers/bns/formathelpers.tsx","helpers/bns/bitcoin.tsx","helpers/bns/cryptography.tsx","helpers/bns/types/types.tsx","interfaces/index.tsx","components/general/RoundButton/RoundButton.tsx","store/reducers/Reducer.tsx","store/index.tsx","helpers/sanitize.js","store/actions/changeAliasAction.tsx","helpers/bns/actions/actions.tsx","helpers/bns/actions/batch.tsx","helpers/bns/calcBnsState.tsx","helpers/bns/forwards/findLatestForwards.tsx","helpers/bns/stringByteCount.tsx","api/blockstream.tsx","store/actions/searchAction.tsx","store/actions/createNewWalletAction.tsx","store/actions/changePageInfoAction.tsx","store/actions/scanAddressFullyAction.tsx","store/actions/changeChoicesBNSAction.tsx","components/SearchResults/SearchResults.tsx","helpers/timediff.tsx","helpers/bns/forwards/interpretFw.tsx","components/HomeContent/HomeContent.tsx","pages/Home.tsx","components/AboutContent/AboutContent.tsx","pages/About.tsx","components/CreateSteps/P1RestoreOrBackup/P1RestoreOrBackup.tsx","components/CreateSteps/CreateHeader/CreateHeader.tsx","components/general/Details/Details.tsx","components/CreateSteps/P2LoadWallet/P2LoadWallet.tsx","components/CreateSteps/P3DomainAndWallet/P3DomainAndWallet.tsx","components/CreateSteps/P4ActionChoice/P4ActionChoice.tsx","components/CreateSteps/P5CustomForwards/P5CustomForwards.tsx","components/CreateSteps/P6Broadcast/P6Broadcast.tsx","components/CreateNavigator/CreateNavigator.tsx","pages/Create.tsx","components/Navbar/Navbar.tsx","App.tsx","components/DevPanel/DevPanel.tsx","index.tsx","components/HomeContent/HomeContent.module.css","components/DevPanel/DevPanel.module.css","components/general/RoundButton/RoundButton.module.css","components/CreateSteps/CreateHeader/CreateHeader.module.css","components/Navbar/Navbar.module.css","helpers/bns/calcP2WSH.tsx","components/general/Details/Details.module.css","components/CreateSteps/P2LoadWallet/P2LoadWallet.module.css","helpers/bns/initialState.tsx"],"names":["module","exports","console","warn","BYTES_MAX","MIN_BURN","MIN_NOTIFY","OWNERSHIP_DURATION_BY_BLOCKS","hash160","bitcoin","op","calcTx","wallet","domain","choices","networkChoice","vBytes","utxoList","length","Error","feeRate","user","getUser","address","network","calcP2WSH","domainName","notificationsAddress","fee","Math","ceil","valueNeeded","totalGathered","gatheredFromWallet","gatheredFromOther","isACSRequired","action","special","some","list","rules","inputs","log","toBeUsedUtxoOfNotifications","derivedUtxoList","forEach","utxo","from_scriptpubkey_address","push","value","toBeUsedUtxoOfUserWallet","toFixed","keyPair","fromWIF","WIF","psbt","setVersion","setLocktime","addInput","hash","txid","index","vout","sequence","nonWitnessUtxo","Buffer","from","hex","witnessScript","compile","OP_DROP","inputScript","OP_TRUE","nonce","toString","encryptionKey","data","encrypt","embedString","embed","burnAmount","reduce","maxBurn","max","output0value","addOutput","script","output","change","signInput","validateSignaturesOfInput","i","finalizeInput","getFinalScripts","tx","extractTransaction","thisVirtualSize","virtualSize","getId","toHex","nInputs","ins","nOutputs","outs","byteLength","notifyAmount","nInputsFromWallet","nInputsFromOther","existsCurrentOwner","st","currentOwner","getOwnerAddress","setOwner","newOwnerAddress","users","getOwner","ownerAddress","updateOwnerHistory","ownersHistory","JSON","parse","stringify","newUser","clearOwner","getParsedHeight","chain","parsedHeight","setParsedHeight","height","getNotificationAddress","notificationAddress","getLastOwnerBurnedValue","isOwnerExpired","owner","winHeight","getTxTimestamp","status","block_time","getTxHeight","block_height","getTxOutput0BurnValue","getTxInput0SourceUserAddress","vin","prevout","scriptpubkey_address","updateSourceUserFromTx","fromAddress","updateHeight","readEmbeddedData","isOpreturnOutput0","embeddedDataHex","scriptpubkey_asm","split","slice","join","getTxOutput0Data","embeddedDataBuffer","decryptionKey","embeddedDataUtf8","decrypt","embeddedDataUtf8Array","forwardsInThisTx","word","thisForward","updateTimestamp","forwards","addToUserForwards","atLeastTwoOutputs","isNotify","getTxOutput1NotifyAddress","didNotifyMin","getTxOutput1NotifyValue","isAddressTheCurrentOwner","isSenderTheCurrentOwner","didBurnMin","burnedPreviousRateMin","updateUtxoFromTx","input","spentUtxoIndex","findIndex","splice","noUnspentUserNotificationsUtxo","userOfTxAddress","txHeight","userThatCreatedThisUtxo","isInThePast","varuint","require","createNewWallet","strNetwork","mnemonic","bip39","generateMnemonic","seedBuffer","mnemonicToSeed","fromSeed","derivePath","toWIF","p2wpkh","pubkey","publicKey","loadWallet","strMnemonic","getUnspentSum","utxoArray","sum","inputIndex","isSegwit","isP2SH","isP2WSH","payment","p2wsh","redeem","p2sh","finalScriptSig","finalScriptWitness","witness","vector","buffer","allocUnsafe","writeVarInt","currentLen","varintLen","encodingLength","concat","encode","writeVarSlice","writeSlice","witnessStackToScriptWitness","undefined","stringText","stringForKey","stringForIV","key","crypto","createHash","update","digest","iv","cipher","createCipheriv","encrypted","final","bufferCypher","decipher","createDecipheriv","decrypted","BNSActions","ActionTypes","RoundButton","props","style","display","show","colorbutton","colorbuttontext","sizebutton","className","styles","roundButtonWrap","back","roundButton","backArrow","next","nextArrow","children","overhead","STORE_SEARCH_RESULTS_FAIL","STORE_SEARCH_RESULTS","TYPING","NEW_WALLET","CHANGE_PAGE_INFO","UPDATE_WALLET","UPDATE_DOMAIN","ACTION_FAIL","LOAD_STATE","CHOICES_BNS_ACTION","reducer","state","payload","type","lastTimeStamp","Date","now","txHistory","pageInfo","checkedWallet","checkedDomain","current","initialState","alias","checkedLightSearch","extension","bidding","txHex","Store","React","createContext","sanitize","inputString","stringOrArray","Array","isArray","filter","logicFilters","choice","str","letter","resultingString","numbers","digits","map","parseInt","warning","outputString","indexOf","fn","RENEW","ONLY_FORWARDS","CLAIM_OWNERSHIP","OUTS_2","info","OUT_0","OUT_1","NOTIFIED_MIN","BURNED_MIN","NO_OWNER","EXISTS_OWNER","BURN_LAST_WIN","USER_IS_OWNER","IS_OWNER_EXPIRED","NO_UNSPENT_USER_NOTIFICATIONS_UTXO","USER_ADDRESS_NOT_NOTIFICATION_ADDRESS","claimOwnershipAction","args","permissions","conditions","execute","senderAddress","winTimestamp","currentOwnerRenewAction","updateForwardingInfoAction","autoCheckForOwnerExpiredAction","updateUtxoFromTxAction","runAllAutomaticActions","areAllConditionsMet","eaCondition","calcBnsState","notificationsHistory","currentHeight","newState","reverse","sort","prev","actions","okConditions","okPermissions","areAllPermissionsMet","eaPermission","findLatestForwards","sortedForwards","currentNetworks","eaForward","startsWith","Object","values","stringByteCount","API_PATH_TESTNET","API_PATH_BITCOIN","getFeeEstimates","a","async","axios","get","res","rateLimit","getHeight","API_PATH","addRawTxToArray","erroredOutputs","error","entries","indexString","tries","getUTXOList","getAddressHistory","txPush","content","params","response","Promise","r","setTimeout","searchAction","dispatch","router","notificationsTxHistory","createNewWalletAction","changePageInfoAction","page","scanAddressFullyAction","addressType","walletAddress","walletTxHistory","utxoListWalletAddress","newDomain","changeChoicesBNSAction","SearchResults","useContext","diff","isExpired","dh","blocksUntilExpires","timestampMsec","referenceTimestampMsec","abs","d","floor","h","m","dhm","msDiff","timeDiff","latestForwards","wrapper","describe","expired","notExpired","listContainer","to","createLink","fw","ifw","render","onNetwork","where","what","link","interpretFw","listItem","href","encodeURI","target","rel","HomeContent","match","history","isSearchDone","inputEl","useRef","useEffect","selectionEnd","selectionStart","focus","lblMainTitle","lblMainTitleAfter","divSearch","divSearchAfter","id","txtSearch","cols","rows","spellCheck","placeholder","ref","onChange","e","sanitizedString","changeAliasAction","onKeyPress","onClick","Home","AboutContent","About","pages","CreateHeader","useState","window","innerWidth","width","setWidth","resize","addEventListener","removeEventListener","fontScale","min","barHeight","aliasMarginTop","marginTop","aliasFontSize","fontSize","cutOverflow","bar","ext","spacer","Details","showDetails","setShowDetails","toggleDetails","title","description","arrow","down","details","P1RestoreOrBackup","ROOT","setPage","backup","setBackup","wordCount","v","Orange","buttonWrapper","LOAD_BACKUP","contentWrapper","restoreBackup","cleanString","toLowerCase","trimLeft","trim","P2LoadWallet","qrCode","setQrCode","qr","toDataURL","err","url","imgQr","src","alt","open","pathEdit","P3DomainAndWallet","apiStatus","setApiStatus","readyStatus","isReady","domainInfo","domainButton","walletInfo","walletButton","unspent","balance","ownership","P4ActionChoice","checkActions","allActions","checkedActions","checkedPermissions","permission","isAllowed","specialTxDirections","condition","isUsable","every","permissionList","runAllActionPermissionChecks","availableActions","unavailableActions","unavailableActions__title","unavailableActions__actionList","unavailableActions__actionList__action","unavailableActions__actionList__action__title","unavailableActions__actionList__action__permissionList","unavailableActions__actionList__action__permissionList__permission","P5CustomForwards","plannedChanges","plannedChangesSoFar","words","setPlannedChanges","objForwards","forwardsString","keys","fwNetwork","pastForwards","textboxContent","setTextboxContent","bytesOfChanges","combineForwards","subtitle","changes","bytesLeft","bytesOver","updateItem","updateInfo","updateCancel","newData","stopPropagation","editor","btnDelete","editorNetwork","cleanText","editorAddress","btnAdd","pastList","pastPair","pastNetwork","pastAddress","P6Broadcast","feeText","setFeeText","showSuggestions","apiSuccess","min20","min40","min60","feeSuggestions","setFeeSuggestions","txIssue","message","numberOfUpdates","countSoFar","ok","reason","broadcastStatus","setBroadcastStatus","unitBTC","showBTC","sats","finalCost","fees","fees__rate","cleanNumber","parseFloat","fees__apicall","apiSuggest","tryFees","fees__feeSelection","fees__feeSelection__choice","totalCost","txSummary","status__button","PATH","status__failed","CreateNavigator","horizontalScaler","Create","Navbar","isCreatePage","useHistory","location","pathname","isHomePage","isAboutPage","root","pageNum","selected","App","searchParam","URLSearchParams","search","pushState","path","component","exact","json","ReactDOM","useReducer","Provider","hidden","setHidden","onDevKey","document","activeElement","getElementById","divDev","button","encodeURIComponent","createElement","download","innerHTML","container","appendChild","click","remove","dlState","btnOutline","sheet","parentNode","removeChild","createTextNode","head","bufferData"],"mappings":"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","file":"static/js/main.7ec3324c.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"P5CustomForwards_wrapper__2kAy2\",\"title\":\"P5CustomForwards_title__29aFH\",\"subtitle\":\"P5CustomForwards_subtitle__1iqt_\",\"changes\":\"P5CustomForwards_changes__23bYg\",\"pastList\":\"P5CustomForwards_pastList__3rXdy\",\"buttonWrapper\":\"P5CustomForwards_buttonWrapper__3hvwB\",\"editor\":\"P5CustomForwards_editor__1ZVVF\",\"updateItem\":\"P5CustomForwards_updateItem__1wAhx\",\"updateCancel\":\"P5CustomForwards_updateCancel__3b5bW\",\"updateInfo\":\"P5CustomForwards_updateInfo__2OBcF\",\"editorNetwork\":\"P5CustomForwards_editorNetwork__1L6UB\",\"editorAddress\":\"P5CustomForwards_editorAddress__1N25M\",\"btnAdd\":\"P5CustomForwards_btnAdd__1tiSg\",\"btnDelete\":\"P5CustomForwards_btnDelete__3NCte\",\"pastPair\":\"P5CustomForwards_pastPair__3YvIk\",\"pastNetwork\":\"P5CustomForwards_pastNetwork__35eVe\",\"pastAddress\":\"P5CustomForwards_pastAddress__3-W_H\",\"bytesLeft\":\"P5CustomForwards_bytesLeft__2zySr\",\"bytesOver\":\"P5CustomForwards_bytesOver__ysfMq\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"CreateNavigator_wrapper__24rTe\",\"horizontalScaler\":\"CreateNavigator_horizontalScaler__2qmoi\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"P6Broadcast_wrapper__32tq-\",\"title\":\"P6Broadcast_title__2fzea\",\"fees\":\"P6Broadcast_fees__STZ2e\",\"txSummary\":\"P6Broadcast_txSummary__24FzE\",\"status\":\"P6Broadcast_status__3SsMv\",\"totalCost\":\"P6Broadcast_totalCost__Agr2T\",\"buttonWrapper\":\"P6Broadcast_buttonWrapper__ROAk6\",\"status__button\":\"P6Broadcast_status__button__fFvc3\",\"status__failed\":\"P6Broadcast_status__failed__1moa8\",\"fees__rate\":\"P6Broadcast_fees__rate__16JxD\",\"fees__apicall\":\"P6Broadcast_fees__apicall__3yPVT\",\"fees__feeSelection\":\"P6Broadcast_fees__feeSelection__rCjmf\",\"fees__feeSelection__choice\":\"P6Broadcast_fees__feeSelection__choice__1jG8w\",\"balance\":\"P6Broadcast_balance__1ZVur\"};","/**\n * Constants used to determine rules on BNS\n */\n\n// testing mode true/false to reduce waiting time for tests\nconst TESTING = true\nTESTING && console.warn('Testing mode ON')\n\n// max data safe to embed in OP_RETURN type tx (bytes)\nconst BYTES_MAX = 80\n\n// Satoshis to burn minimum for attempting ownership (satoshi)\nconst MIN_BURN = 1000\n\n//  Minimum to use for notification output (satoshi)\nconst MIN_NOTIFY  = 1000\n\n// Ownership duration after victory (blocks)\nconst OWNERSHIP_DURATION_BY_BLOCKS = !TESTING ? 52560 : 1000\n// ^ (real) 52560 blocks ~365 days.\n// (testing) 288 blocks ~48 hours. 1000 blocks ~ a week\n// Block times can vary from 10 minutes.\n// const CHALLENGE_PERIOD_DURATION_BY_BLOCKS = 3456\n// ^ ~24 hours. Only matters if someone is monitoring specific domainName, otherwise they won't know what domainName the bids are for.\n\nexport {\n  TESTING,\n  MIN_BURN,\n  MIN_NOTIFY,\n  OWNERSHIP_DURATION_BY_BLOCKS,\n  BYTES_MAX\n}","import * as bitcoin from 'bitcoinjs-lib'\nimport { calcP2WSH } from './calcP2WSH'\nimport { MIN_BURN, MIN_NOTIFY } from './constants'\nimport { encrypt } from './cryptography'\nimport { I_Domain, I_Action_Choice } from './types/'\nimport { getUser } from './formathelpers'\nimport { getFinalScripts } from './bitcoin'\n\nconst hash160 = bitcoin.crypto.hash160\nconst op = bitcoin.opcodes\n\ninterface I_Tx_Result {\n  thisVirtualSize: number\n  txid: number\n  hex: string\n  valueNeeded: number\n  fee: number\n  change: number\n  burnAmount: number\n  notifyAmount: number\n  totalGathered: number\n  gatheredFromWallet: number\n  gatheredFromOther: number\n  nInputs: number\n  nOutputs: number\n  nInputsFromWallet: number\n  nInputsFromOther: number\n}\n\n/**\n * Creates hex of tx to bid on domain.\n * Throws error if not enough funds.\n * Leave vBytes blank, it will call itself via recursion until it derives needed size.\n * @param   {object}      wallet                  - { WIF, address, txHistory, utxoList, ... }.\n * @param   {object}      domain                  - all domain info\n * @param   {object}      choices                 - { action, feeRate, embedString, ... }\n * @param   {string}      networkChoice           - 'testnet' or 'bitcoin' (matches bitcoinjs-lib).\n * @param   {number=}     [vBytes=0]              - size of transaction in vBytes. *\n * @returns {object}                              - Tx Results.\n */\nexport const calcTx = (\n  wallet: any,\n  domain: I_Domain,\n  choices: { action: I_Action_Choice, feeRate: number, embedString: string, [key: string]: any },\n  networkChoice: string,\n  vBytes: number = 0\n): I_Tx_Result => {\n\n  if (wallet.utxoList.length === 0) {\n    throw new Error('Wallet has no funds (utxo) to use')\n  }\n\n  // grab fee rate\n  const feeRate = choices.feeRate\n  // grab user object\n  const user = getUser({ domain }, wallet.address)\n  // grab network object\n  const network = bitcoin.networks[networkChoice]\n\n  // calculate domain notification address\n  const { notificationsAddress } = calcP2WSH(domain.domainName, networkChoice)\n\n  // calculate funds necessary for this tx, round up sat for more better than being below minimum.\n  const fee = Math.ceil(vBytes * feeRate)\n  const valueNeeded = MIN_BURN + MIN_NOTIFY + fee; // sat\n\n  // gather necessary utxo to use until enough to cover costs\n  let totalGathered = 0 // sat\n\n  // track multiple sources for providing detailed information\n  let gatheredFromWallet = 0\n  let gatheredFromOther = 0\n\n  // prepare extra inputs from other rules\n  // adding these first to totalGathered satoshi since have to add them all anyway\n  const isACSRequired = choices.action.special.some(list =>\n    list.rules.inputs && (list.rules.inputs === 'NO_USER_NOTIFICATION_UTXO')\n  )\n  isACSRequired && console.log('spending user\\'s previous acs utxo appears required')\n  let toBeUsedUtxoOfNotifications: Array<any> = []\n  if (isACSRequired) {\n    // must consume all ACS utxo wallet.address has created\n    // get all utxo for notification address\n    domain.derivedUtxoList.forEach(utxo => {\n      // use only utxo created from this wallet's address\n      if (utxo.from_scriptpubkey_address === wallet.address) {\n        toBeUsedUtxoOfNotifications.push(utxo)\n        totalGathered += utxo.value\n        gatheredFromOther += utxo.value\n      }\n    })\n  }\n\n  // Adding remaining funds from user's wallet to total Gathered\n  // Must always add at least 1 user utxo @ index 0 to indicate ownership\n  let toBeUsedUtxoOfUserWallet: Array<any> = []\n  wallet.utxoList.forEach((utxo: any) => {\n    // while not enough funds or if haven't added a single user utxo yet\n    if (totalGathered < valueNeeded || toBeUsedUtxoOfUserWallet.length === 0) {\n      toBeUsedUtxoOfUserWallet.push(utxo)\n      totalGathered += utxo.value\n      gatheredFromWallet += utxo.value\n    }\n  })\n\n  // all utxo parsed at this point\n\n  // if still not enough funds after all possible inputs,\n  // there are simply not enough funds to do the tx\n  if (totalGathered < valueNeeded) {\n    throw new Error('Not enough funds available (' + (valueNeeded / 1e8).toFixed(8) + ' sats)')\n  }\n\n\n  // calculate keys from wallet import format key\n  const keyPair = bitcoin.ECPair.fromWIF(wallet.WIF, network)\n  // create Partially Signed Bitcoin Transaction object to build tx\n  const psbt = new bitcoin.Psbt({ network })\n  psbt.setVersion(2)    // default\n  psbt.setLocktime(0)   // default\n\n  // add all inputs to transaction\n\n  // must be first added as owner address must always be at index 0 input\n  toBeUsedUtxoOfUserWallet.forEach(utxo => {\n    psbt.addInput({\n      hash: utxo.txid,\n      index: utxo.vout,\n      sequence: 0xfffffffe,\n      // should work for segwit and nonsegwit inputs\n      nonWitnessUtxo: Buffer.from(utxo.hex, 'hex')\n    })\n  })\n\n  // calculate witnessScript\n  const witnessScript = bitcoin.script.compile([\n    hash160(Buffer.from(domain.domainName, 'utf8')),\n    op.OP_DROP\n  ])\n\n  const inputScript = bitcoin.script.compile([op.OP_TRUE])\n\n  if (isACSRequired) {\n\n    // add each utxo to inputs\n    toBeUsedUtxoOfNotifications.forEach(utxo => {\n      if (!utxo.hex) {\n        // abort if missing raw hex\n        throw new Error(`Utxo is missing hex, txid: ${utxo.txid}, vout:${utxo.vout}`)\n      }\n      psbt.addInput({\n        hash: utxo.txid,\n        index: utxo.vout,\n        sequence: 0xfffffffe,\n        nonWitnessUtxo: Buffer.from(utxo.hex, 'hex'),\n        witnessScript: witnessScript\n      })\n    })\n  }\n\n  // inputs done\n\n  // outputs now\n\n  // add the op_return output (always index 0)\n  // if first time sending, nonce is '0', otherwise the last blockheight when this user has sent ANY tx to that notification address\n  // TODO calculate nonce in case this owner has unspent acs utxo left at notification address\n  const nonce = user.nonce.toString()\n  const encryptionKey =  domain.domainName + wallet.address + nonce\n  console.log('nonce used to encrypt', domain.domainName, wallet.address, nonce)\n  const data = encrypt(choices.embedString, encryptionKey)\n  const embed = bitcoin.payments.embed({ data: [data] })\n\n  // output[0]: check special tx rules for max amount required to burn among all of them\n  const burnAmount = choices.action.special.reduce((maxBurn: number, list: any) => {\n    console.log('choices.action.special each item:', list)\n    return (\n      // if there's another burn rule, use the highest value\n      ('output0value' in list.rules)\n        ? Math.max(maxBurn, list.rules.output0value)\n        : maxBurn\n    )\n  }, 0)\n  psbt.addOutput({\n    script: embed.output,\n    value: burnAmount,\n  })\n  console.log('rules say to burn ', burnAmount)\n\n  // add notification output (always index 1)\n  psbt.addOutput({\n    address: notificationsAddress, // calculated from domainName provided\n    value: MIN_NOTIFY\n  })\n\n  // add change output (anything is fine for output[2] or higher)\n  const change = totalGathered - valueNeeded\n  psbt.addOutput({\n    address: wallet.address,\n    value: change\n  })\n\n  // at this point all inputs & outputs added so ready to sign\n\n  toBeUsedUtxoOfUserWallet.forEach((utxo, index) => {\n    // sign p2wpkh of controlling\n    psbt.signInput(index, keyPair)\n    // (TODO) signing ACS inputs will need script\n\n    if (!psbt.validateSignaturesOfInput(index)) {\n      throw new Error('Signature validation failed for input index ' + index.toString())\n    }\n  })\n\n  // finalizing inputs\n  // psbt.finalizeAllInputs()\n\n  // finalize regular p2wsh inputs normally\n  for (let i = 0; i < toBeUsedUtxoOfUserWallet.length; i++) {\n    psbt.finalizeInput(i)\n  }\n  // finalize witness script stack inputs with extra parameter\n  // for the submitted script parameters & original full script\n  for (\n    let i = toBeUsedUtxoOfUserWallet.length;\n    i < toBeUsedUtxoOfUserWallet.length + toBeUsedUtxoOfNotifications.length;\n    i++\n  ) {\n    psbt.finalizeInput(i, getFinalScripts({ inputScript, network }))\n  }\n\n  const tx = psbt.extractTransaction()\n  console.log(tx)\n  const thisVirtualSize = tx.virtualSize()\n  const txid = tx.getId()\n  const hex = tx.toHex()\n  const nInputs = tx.ins.length\n  const nOutputs = tx.outs.length\n\n  if (vBytes >= thisVirtualSize) {\n    // If this tx fee was calculated for a vBytes size equal to or larger than the resulting derived tx (thisVirtualSize),\n    // fee should be safe by being equal to or larger than necessary at required feeRate.\n    // Obviously vBytes = 0 will never give the correct fee minimum the first time through.\n    console.log('virtualSize', tx.virtualSize())\n    console.log('byteLength', tx.byteLength())\n    console.log('getId', tx.getId())\n    console.log('hex', tx.toHex())\n    console.log('')\n    return {\n      txid,\n      thisVirtualSize,\n      hex, valueNeeded,\n      fee,\n      change,\n      burnAmount,\n      notifyAmount: MIN_NOTIFY,\n      totalGathered,\n      gatheredFromWallet,\n      gatheredFromOther,\n      nInputs,\n      nOutputs,\n      nInputsFromWallet: toBeUsedUtxoOfUserWallet.length,\n      nInputsFromOther: toBeUsedUtxoOfNotifications.length || 0\n    }\n  } else {\n    // Redo this tx calculation using the virtual size we just calculated for vByte optional parameter.\n    return calcTx(\n      wallet, domain, choices, networkChoice, thisVirtualSize\n    )\n  }\n}\n\n\n\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"AboutContent_wrapper__1kfnm\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"P1RestoreOrBackup_wrapper__32TQJ\",\"title\":\"P1RestoreOrBackup_title__2rH-6\",\"contentWrapper\":\"P1RestoreOrBackup_contentWrapper__1NT85\",\"buttonWrapper\":\"P1RestoreOrBackup_buttonWrapper__2ryAq\",\"describe\":\"P1RestoreOrBackup_describe__1RMqs\",\"Orange\":\"P1RestoreOrBackup_Orange__2IaJN\",\"spacer\":\"P1RestoreOrBackup_spacer__3luud\",\"backup\":\"P1RestoreOrBackup_backup__357rd\",\"restoreBackup\":\"P1RestoreOrBackup_restoreBackup__VUHgs\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"P4ActionChoice_wrapper__2u2J5\",\"title\":\"P4ActionChoice_title__2PdRs\",\"availableActions\":\"P4ActionChoice_availableActions__1O5aS\",\"unavailableActions\":\"P4ActionChoice_unavailableActions__3rEYI\",\"buttonWrapper\":\"P4ActionChoice_buttonWrapper__3Sx3Y\",\"unavailableActions__title\":\"P4ActionChoice_unavailableActions__title__2EQ4_\",\"unavailableActions__actionList\":\"P4ActionChoice_unavailableActions__actionList__1VAc_\",\"unavailableActions__actionList__action\":\"P4ActionChoice_unavailableActions__actionList__action__GMwoW\",\"unavailableActions__actionList__action__title\":\"P4ActionChoice_unavailableActions__actionList__action__title__3ljZU\",\"unavailableActions__actionList__action__permissionList\":\"P4ActionChoice_unavailableActions__actionList__action__permissionList__2pKeq\",\"unavailableActions__actionList__action__permissionList__permission\":\"P4ActionChoice_unavailableActions__actionList__action__permissionList__permission__2eF7F\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"P3DomainAndWallet_wrapper__1ElFg\",\"contentWrapper\":\"P3DomainAndWallet_contentWrapper__vm5qp\",\"title\":\"P3DomainAndWallet_title__3ing2\",\"domainInfo\":\"P3DomainAndWallet_domainInfo__3p2aJ\",\"domainButton\":\"P3DomainAndWallet_domainButton__2PIDz\",\"walletInfo\":\"P3DomainAndWallet_walletInfo__2cQY0\",\"walletButton\":\"P3DomainAndWallet_walletButton__MmLZ3\",\"unspent\":\"P3DomainAndWallet_unspent__bUWZW\",\"buttonWrapper\":\"P3DomainAndWallet_buttonWrapper__djJkL\",\"ownership\":\"P3DomainAndWallet_ownership__lSY6a\",\"balance\":\"P3DomainAndWallet_balance__2fns7\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"SearchResults_wrapper__VvaYk\",\"listContainer\":\"SearchResults_listContainer__12vQE\",\"listItem\":\"SearchResults_listItem__3Udwx\",\"key\":\"SearchResults_key__358jo\",\"describe\":\"SearchResults_describe__3HACm\",\"expired\":\"SearchResults_expired__2ptnD\",\"notExpired\":\"SearchResults_notExpired__2m4VI\",\"createLink\":\"SearchResults_createLink__13Wez\"};","import { newUser } from './initialState'\nimport { OWNERSHIP_DURATION_BY_BLOCKS, MIN_BURN, MIN_NOTIFY } from './constants'\nimport { I_User, I_Forward, I_BnsState, I_TX, I_UTXO } from './types/'\nimport { decrypt } from './cryptography'\n\n// ========== helper functions =====================\n\nexport const existsCurrentOwner = (st: I_BnsState): boolean => st.domain.currentOwner !== ''\n\nexport const getOwnerAddress = (st: I_BnsState): string => st.domain.currentOwner || ''\n\nexport const setOwner = (st: I_BnsState, newOwnerAddress: string) => {\n  st.domain.currentOwner = newOwnerAddress\n}\n\nexport const getUser = (st: I_BnsState, address: string): I_User => st.domain.users[address]\n\nexport const getOwner = (st: I_BnsState) => {\n  const ownerAddress = getOwnerAddress(st)\n  if (!ownerAddress) return undefined\n  return getUser(st, ownerAddress)\n}\n\nexport const updateOwnerHistory = (st: I_BnsState): void => {\n  st.domain.ownersHistory.push(getOwner(st) || JSON.parse(JSON.stringify(newUser)))\n}\n\nexport const clearOwner = (st: I_BnsState): void => { st.domain.currentOwner = '' }\n\nexport const getCurrentHeight = (st: I_BnsState): number => st.chain?.currentHeight || 0\nexport const getParsedHeight = (st: I_BnsState): number => st.chain?.parsedHeight || 0\nexport const setParsedHeight = (st: I_BnsState, height: number): void => {\n  st.chain && (st.chain.parsedHeight = height)\n}\n\nexport const getNotificationAddress = (st: I_BnsState): string => st.domain.notificationAddress || ''\n\nexport const getLastOwnerBurnedValue = (st: I_BnsState): number => getOwner(st)?.burnAmount || 0\n\nexport const isOwnerExpired = (st: I_BnsState): boolean => {\n  if (!existsCurrentOwner(st)) return true // no owner same as expired\n  const owner = getOwner(st)\n  if (!owner) {\n    console.log('isOwnerExpired: owner exists but no user with such address stored')\n    return true\n  }\n  const blocksSinceUpdate = getParsedHeight(st) - owner.winHeight\n  return blocksSinceUpdate > OWNERSHIP_DURATION_BY_BLOCKS\n}\n\n// ===== tx functions (getters) =====================\n\nexport const getTxTimestamp = (tx: I_TX): number => tx.status.block_time || 0\nexport const getTxHeight = (tx: I_TX): number => tx.status.block_height || 0\n\nexport const getTxOutput0BurnValue = (tx: I_TX): number => tx.vout[0]?.value || 0\nexport const getTxOutput0Data = (tx: I_TX):string => {\n  if (isOpreturnOutput0(tx)) {\n    // remove 'OP_RETURN OP_PUSHBYTES_5 ' from it and return the rest\n    return tx.vout[0].scriptpubkey_asm.split(' ').slice(2).join('')\n  }\n  return ''\n}\n\nexport const getTxOutput1NotifyValue = (tx: I_TX): number => tx.vout[1]?.value || 0\nexport const getTxOutput1NotifyAddress = (tx: I_TX): string => tx.vout[1]?.scriptpubkey_address || ''\n\nexport const getTxInput0SourceUserAddress = (tx: I_TX): string => (\n  tx.vin[0]?.prevout.scriptpubkey_address || ''\n)\n\n\n// ======= update state from tx (setters) ========\n\n// update the info for the source user of the tx within bns state\n// when ran a second time, it simply updates nonce for post-tx value\nexport const updateSourceUserFromTx = (st: I_BnsState, tx: I_TX): void => {\n  const fromAddress = getTxInput0SourceUserAddress(tx)\n\n  // create new user if not already one of users\n  if (!(fromAddress in st.domain.users)) {\n    // create new user object by copying values of newUser object\n    st.domain.users[fromAddress] = JSON.parse(JSON.stringify(newUser))\n    console.log('new source created:', fromAddress)\n  }\n\n  // update user\n  const user = st.domain.users[fromAddress]\n  user.address = fromAddress\n  user.nonce = user.updateHeight\n  user.updateHeight = getTxHeight(tx)\n}\n\nexport const addToUserForwards = (\n  st: I_BnsState,\n  fromAddress: string,\n  forwardsInThisTx: Array<I_Forward>\n) => {\n  const user = getUser(st, fromAddress)\n  user.forwards = [...user.forwards, ...forwardsInThisTx]\n}\n\nexport const readEmbeddedData = (st: I_BnsState, tx: I_TX):void => {\n  // only go on if there is op_return with embedded data on output 0\n  if (!isOpreturnOutput0(tx)) {\n    console.log(getTxHeight(tx), ': no op_return found for txid')\n    return undefined\n  }\n\n  // get useful object references\n  const fromAddress = getTxInput0SourceUserAddress(tx)\n  const user = getUser(st, fromAddress)\n  const nonce = user.nonce.toString()\n\n  const embeddedDataHex = getTxOutput0Data(tx)\n  const embeddedDataBuffer = Buffer.from(embeddedDataHex, 'hex')\n\n  const decryptionKey = st.domain.domainName + user.address + nonce\n  console.log(\n    getTxHeight(tx),\n    ': decryption key: ',\n    st.domain.domainName,\n    user.address,\n    nonce\n  )\n  const embeddedDataUtf8 = decrypt(embeddedDataBuffer, decryptionKey)\n  console.log(getTxHeight(tx), ': found embedded data:', embeddedDataUtf8)\n\n  // split by spaces into array\n  const embeddedDataUtf8Array = embeddedDataUtf8.split(' ')\n\n  // collect all forwards in this tx\n  const forwardsInThisTx: Array<I_Forward> = []\n\n  embeddedDataUtf8Array.forEach((word: string, index: number) => {\n    // everything must be space separated in pairs\n    // so single block might mean failed decryption or\n    // last unpaired block might be padding or future versioning\n    // grabbing only odd and 1 before it values, only grabbing pairs\n    if (index % 2 === 1) {\n      const networkPiece = embeddedDataUtf8Array[index - 1]\n      const forwardingAddressPiece = word\n      const thisForward = {\n        network:          networkPiece,\n        address:          forwardingAddressPiece,\n        updateHeight:     getTxHeight(tx),\n        updateTimestamp:  getTxTimestamp(tx)\n      }\n      forwardsInThisTx.push(thisForward)\n    }\n  })\n\n  // update forwards on the user\n  addToUserForwards(st, fromAddress, forwardsInThisTx)\n}\n\n// ===== rule checks (getters) =====\n\n// Describe:    2 outputs minimum\nexport const atLeastTwoOutputs = (tx: I_TX): boolean => tx.vout.length >= 2\n\n// Describe:    Is [0] output OP_RETURN type\nexport const isOpreturnOutput0 = (tx: I_TX): boolean => (\n  tx.vout[0].scriptpubkey_asm.split(' ')[0] === 'OP_RETURN'\n)\n\n// Describe:    Is [1] output this domain's notification address?\nexport const isNotify =  (st: I_BnsState, tx: I_TX): boolean => (\n  getTxOutput1NotifyAddress(tx) === getNotificationAddress(st)\n)\n\n// Describe:    At least minimum amount used in notification output? (Dust level is main danger)\nexport const didNotifyMin = (tx: I_TX): boolean => getTxOutput1NotifyValue(tx) >= MIN_NOTIFY\n\n// Describe:    Is address the current domain owner?\nexport const isAddressTheCurrentOwner = (st: I_BnsState, address: string): boolean =>\n  getOwnerAddress(st) === address\n\n// Describe:    Is tx sender the current domain owner (input [0], id'ed by address)?\nexport const isSenderTheCurrentOwner = (st: I_BnsState, tx: I_TX): boolean =>\n  getOwnerAddress(st) === getTxInput0SourceUserAddress(tx)\n\n// Describe:    At least minimum amount burned?\nexport const didBurnMin = (tx: I_TX): boolean =>\n  getTxOutput0BurnValue(tx) >= MIN_BURN\n\n// Describe:    Burned at least as much as previously burnt\nexport const burnedPreviousRateMin = (st: I_BnsState, tx: I_TX): boolean => (\n  getTxOutput0BurnValue(tx) >= getLastOwnerBurnedValue(st)\n)\n\n// Describe: update current derivedUtxoList from tx\n// Since utxo in question are the notificaiton address utxo,\n// they will always be part of txHistory\nexport const updateUtxoFromTx = (st: I_BnsState, tx: I_TX): void => {\n  const notificationAddress = getNotificationAddress(st)\n\n  // scan every tx input for notification address and remove those from utxo set\n  tx.vin.forEach((input: any) => {\n    // can scan by previous address or by current utxo list's txid+vout pairs\n    if (input.prevout.scriptpubkey_address === notificationAddress) {\n      const txid = input.txid\n      const vout = input.vout\n      // find first match with these values in derivedUtxoList\n      const spentUtxoIndex = st.domain.derivedUtxoList.findIndex(utxo => (\n        utxo.txid === txid && utxo.vout === vout\n      ))\n      // remove element at the position found\n      // utxo can only be spent once so first match ok\n      st.domain.derivedUtxoList.splice(spentUtxoIndex, 1)\n    }\n  })\n\n  // scan every tx output for notification address and add those to utxo set\n  tx.vout.forEach((output: any, vout: number) => {\n    if (output.scriptpubkey_address === notificationAddress) {\n      // if output address is notification address, it's always new utxo\n      // mark from address as address @ input 0 of the tx\n      st.domain.derivedUtxoList.push({\n        txid: tx.txid,\n        vout: vout,\n        status: tx.status,\n        value: output.value,\n        from_scriptpubkey_address: getTxInput0SourceUserAddress(tx)\n      } as I_UTXO)\n    }\n  })\n}\n\n// returns true only if there are no utxo (at notification address) where the sender address (input[0] in the past) is the same as the sender address of this tx (input[0])\nexport const noUnspentUserNotificationsUtxo = (st: I_BnsState, tx: I_TX): boolean => {\n  // sender address of this tx\n  const userOfTxAddress = getTxInput0SourceUserAddress(tx)\n  const txHeight = getTxHeight(tx)\n\n  // go through all derived utxo and make sure none are from this sender\n  for (const utxo of st.domain.derivedUtxoList) {\n    // user that created this utxo\n    const userThatCreatedThisUtxo = utxo.from_scriptpubkey_address\n\n    // block height of utxo creation\n    const utxoHeight = utxo.status.block_height\n\n    // only utxo formed before this tx height matter\n    // this tx would've likely created a new utxo that shouldn't count\n    const isInThePast = utxoHeight < txHeight\n\n    // all utxo in derived set should have from address\n    !userThatCreatedThisUtxo && console.log(\n      'st.domain.derivedUtxoList for some reason has undefined from_scriptpubkey_address'\n    )\n    // if even 1 matches, the check failed\n    if ((userThatCreatedThisUtxo === userOfTxAddress) && isInThePast) {\n      return false\n    }\n  }\n\n  // only gets this far if no utxo creators match our current tx user\n  return true\n}","import * as bitcoin from 'bitcoinjs-lib'\r\nimport bip39 from 'bip39'\r\nconst varuint = require('varuint-bitcoin');\r\n\r\n\r\n/**\r\n * Scans the address for utxo on a given network.\r\n * (In BNS would be useful for wallet and notification address)\r\n */\r\n// export const scanAddress = async (address: string, strNetwork: string) => {\r\n  // create array of utxo\r\n\r\n\r\n  // add full tx hex to that array (might take time)\r\n// }\r\n\r\n/**\r\n * Make new mnemonic for p2wpkh m/44'/0'/0'/0/0 address and WIF.\r\n * @param     {string}    strNetwork    String describing network ('bitcoin', 'testnet').\r\n * @returns   {object}                  Object { mnemonic, WIF, address } - all strings.\r\n */\r\nexport const createNewWallet = (strNetwork: string) => {\r\n  // network version. bitcoin or testnet\r\n  const network = bitcoin.networks[strNetwork]\r\n  // create backup phrase\r\n  const mnemonic = bip39.generateMnemonic()\r\n  const seedBuffer = bip39.mnemonicToSeed(mnemonic)\r\n  // create derivation master node\r\n  const masterNode = bitcoin.bip32.fromSeed(seedBuffer, network)\r\n  // derive m/44'/0'/0'/0 /0 node\r\n  const childNode0 = masterNode.derivePath(\"m/44'/0'/0'\").derivePath(\"0/0\")\r\n  // get private key in wallet import format for that child node\r\n  const WIF = childNode0.toWIF()\r\n  // derive a standard p2wpkh address from that WIF\r\n  const keyPair = bitcoin.ECPair.fromWIF(WIF, network)\r\n  const address = bitcoin.payments.p2wpkh({ pubkey: keyPair.publicKey, network }).address\r\n\r\n  return { mnemonic, WIF, address }\r\n}\r\n\r\n/**\r\n * Load p2wpkh m/44'/0'/0'/0/0 wallet info from mnemonic.\r\n * @param     {string}    strMnemonic     Mnemonic string of 12 words as described in bip39.\r\n * @param     {string}    strNetwork      String describing network ('bitcoin', 'testnet').\r\n * @returns   {object}                    Object { mnemonic, WIF, address } - all strings.\r\n */\r\nexport const loadWallet = (strMnemonic: string, strNetwork: string) => {\r\n  // network version. bitcoin or testnet\r\n  const network = bitcoin.networks[strNetwork]\r\n  const seedBuffer = bip39.mnemonicToSeed(strMnemonic)\r\n  // create derivation master node\r\n  const masterNode = bitcoin.bip32.fromSeed(seedBuffer, network)\r\n  // derive m/44'/0'/0'/0 /0 node\r\n  const childNode0 = masterNode.derivePath(\"m/44'/0'/0'\").derivePath(\"0/0\")\r\n  // get private key in wallet import format for that child node\r\n  const WIF = childNode0.toWIF()\r\n  // derive a standard p2wpkh address from that WIF\r\n  const keyPair = bitcoin.ECPair.fromWIF(WIF, network)\r\n  const address = bitcoin.payments.p2wpkh({ pubkey: keyPair.publicKey, network }).address\r\n\r\n  return { mnemonic: strMnemonic, WIF, address }\r\n}\r\n\r\n\r\n//\r\n/**\r\n * Parse UTXO array to get total unspent balance in satoshi.\r\n * @param     {Array}    utxoArray      Array of UTXO objects with '.value' field in satoshi.\r\n * @returns   {number}                  Total number of unspent satoshi.\r\n */\r\nexport function getUnspentSum(utxoArray: Array<any>): number {\r\n\r\n  const sumSats = utxoArray?.reduce(\r\n    (sum: number, utxo: any) => sum + utxo.value\r\n    , 0) || 0\r\n\r\n  return sumSats\r\n}\r\n\r\n\r\n/**\r\n * Finalize outputs that require custom scripts.\r\n * Based on based on https://github.com/bitcoinjs/bitcoinjs-lib/blob/master/test/integration/csv.spec.ts\r\n */\r\nexport const getFinalScripts = ({ inputScript, network }: any) => {\r\n  return function (\r\n    inputIndex: number,\r\n    input: any,\r\n    script: Buffer,\r\n    isSegwit: boolean,\r\n    isP2SH: boolean,\r\n    isP2WSH: boolean,\r\n  ): {\r\n    finalScriptSig: Buffer | undefined;\r\n    finalScriptWitness: Buffer | undefined;\r\n  } {\r\n    // Step 1: Check to make sure the meaningful script matches what you expect.\r\n\r\n    // Step 2: Create final scripts\r\n    let payment: any = {\r\n      network,\r\n      output: script,\r\n      input: inputScript,\r\n    };\r\n    if (isP2WSH && isSegwit)\r\n      payment = bitcoin.payments.p2wsh({\r\n        network,\r\n        redeem: payment,\r\n      });\r\n    if (isP2SH)\r\n      payment = bitcoin.payments.p2sh({\r\n        network,\r\n        redeem: payment,\r\n      });\r\n\r\n    function witnessStackToScriptWitness(witness: Buffer[]): Buffer {\r\n      let buffer = Buffer.allocUnsafe(0);\r\n\r\n      function writeSlice(slice: Buffer): void {\r\n        buffer = Buffer.concat([buffer, Buffer.from(slice)]);\r\n      }\r\n\r\n      function writeVarInt(i: number): void {\r\n        const currentLen = buffer.length;\r\n        const varintLen = varuint.encodingLength(i);\r\n\r\n        buffer = Buffer.concat([buffer, Buffer.allocUnsafe(varintLen)]);\r\n        varuint.encode(i, buffer, currentLen);\r\n      }\r\n\r\n      function writeVarSlice(slice: Buffer): void {\r\n        writeVarInt(slice.length);\r\n        writeSlice(slice);\r\n      }\r\n\r\n      function writeVector(vector: Buffer[]): void {\r\n        writeVarInt(vector.length);\r\n        vector.forEach(writeVarSlice);\r\n      }\r\n\r\n      writeVector(witness);\r\n\r\n      return buffer;\r\n    }\r\n\r\n    return {\r\n      finalScriptSig: payment.input,\r\n      finalScriptWitness:\r\n        payment.witness && payment.witness.length > 0\r\n          ? witnessStackToScriptWitness(payment.witness)\r\n          : undefined,\r\n    };\r\n  }\r\n}","import crypto from 'crypto'\n\n/**\n * Encrypt - symmetric - aes-256-crt\n * @param   {string}  stringText      To be encrypted (up to 80 bytes)\n * @param   {string}  stringForKey    Derive Key from (not final Key).\n * @param   {string}  stringForIV     Derive IV from (not final IV). Defaults as stringForKey.\n * @returns {Buffer}                  Buffer to embed in tx.\n */\nexport const encrypt = (\n  stringText: string, stringForKey: string, stringForIV: string = stringForKey\n) => {\n  // aes-NUMBER-TYPE\n  // Must have key size matching NUMBER (in aes name) of bits (NUMBER/8 bytes)\n  // Must have IV matching encryption block size, 16 bytes for AES128-to-256-range in cbc mode\n  // sha256 can make 32 byte buffer out of anything and then .slice(0, N) can cut it to N bytes\n\n  const key = crypto.createHash('sha256').update(stringForKey).digest()             // 32 bytes\n  const iv = crypto.createHash('sha256').update(stringForIV).digest().slice(0, 16)  // 16 bytes\n\n  let cipher = crypto.createCipheriv('aes-256-ctr', key, iv)\n  let encrypted = cipher.update(Buffer.from(stringText))\n\n  encrypted = Buffer.concat([encrypted, cipher.final()])\n\n  return encrypted\n}\n\n /**\n * Decrypt - symmetric - aes-256-crt\n * @param   {Buffer}  stringText      Buffer to be decrypted.\n * @param   {string}  stringForKey    Derive Key from (not final Key).\n * @param   {string}  stringForIV     Derive IV from (not final IV). Defaults as stringForKey.\n * @returns {Buffer}                  Buffer to utf8 embeded in tx.\n */\nexport const decrypt = (\n  bufferCypher: Buffer, stringForKey: string, stringForIV: string = stringForKey\n) => {\n\n  const key = crypto.createHash('sha256').update(stringForKey).digest()             // 32 bytes\n  const iv = crypto.createHash('sha256').update(stringForIV).digest().slice(0, 16)  // 16 bytes\n\n  let decipher = crypto.createDecipheriv('aes-256-ctr', key, iv)\n\n  // first part\n  let decrypted = decipher.update(bufferCypher)\n\n  // the rest\n  decrypted = Buffer.concat([decrypted, decipher.final()])\n\n  return decrypted.toString('utf8')\n}\n\n","// for BNS\nexport enum BNSActions {\n  RENEW = 'RENEW',\n  ONLY_FORWARDS = 'ONLY_FORWARDS',\n  CLAIM_OWNERSHIP = 'CLAIM_OWNERSHIP'\n}\n\nexport interface I_BNS_Action {\n  type: BNSActions\n  info: string\n  permissions: Array<any>\n  conditions: Array<any>\n  execute: () => void\n  warning?: string | undefined\n}\n\nexport interface I_BNS_Auto_Action {\n  info: string\n  conditions: Array<any>\n  execute: () => void\n}\n\nexport interface I_Action_Choice {\n  type: BNSActions\n  info: string\n  special: Array<any>\n}\n\nexport interface I_BnsState {\n  domain: I_Domain\n  chain?: {\n    parsedHeight: number\n    currentHeight: number\n  }\n}\n\nexport interface I_Domain {\n  domainName: string\n  notificationAddress: string\n  txHistory: Array<I_TX>\n  derivedUtxoList: Array<I_UTXO>\n  utxoList: Array<I_UTXO>\n  users: {\n    [key: string]: I_User\n  }\n  currentOwner: string\n  bidding: {}\n  ownersHistory: Array<I_User>\n}\n\nexport interface I_User {\n  address:      string\n  forwards:     Array<I_Forward>\n  burnAmount:   number\n  winHeight:    number\n  winTimestamp: number\n  nonce:        number\n  updateHeight: number\n}\n\n  // each forward object has the following data\nexport interface I_Forward {\n  network: string\n  address: string\n  updateHeight: number\n  updateTimestamp: number\n}\n\n\n\n\nexport interface I_TX {\n  txid: string\n  version: number\n  locktime: number\n  size: number\n  weight: number\n  fee: number\n  vin: Array <{\n    txid: string\n    vout: number\n    prevout: {\n      scriptpubkey: string\n      scriptpubkey_asm: string\n      scriptpubkey_type: string\n      scriptpubkey_address: string\n    }\n    scriptsig: string\n    scriptsig_asm: string\n    witness: {\n      [key: number]: string\n    }\n    is_coinbase: boolean\n    sequence: number\n  }>\n  vout: Array <{\n    scriptpubkey: string\n    scriptpubkey_asm: string\n    scriptpubkey_type: string\n    scriptpubkey_address: string // op return case?\n    value: number\n  }>\n  status: {\n    confirmed: boolean      // unconfirmed case?\n    block_height: number\n    block_hash: string\n    block_time: number\n  }\n}\n\nexport interface I_UTXO {\n  txid: string\n  vout: number\n  status: {\n    confirmed: boolean\n    block_height: number\n    block_hash: string\n    block_time: number\n  }\n  value: number\n  hex?: string\n  from_scriptpubkey_address?: string\n}\n\nexport interface I_Condition {\n  info: string\n  status: () => boolean\n  special?: { [key: string]: string | number }\n}","import {\n  I_Domain,\n  I_TX,\n  I_UTXO,\n  I_Action_Choice\n} from './../helpers/bns/types/'\n\n/**\n * All the interfaces & enums\n */\n\n\nexport * from './../helpers/bns/types/'\n\n// for global state action creators\nexport enum ActionTypes {\n  STORE_SEARCH_RESULTS = 'STORE_SEARCH_RESULTS',\n  STORE_SEARCH_RESULTS_FAIL = 'STORE_SEARCH_RESULTS_FAIL',\n  TYPING = 'TYPING',\n  NEW_WALLET = 'NEW_WALLET',\n  CHANGE_PAGE_INFO = 'CHANGE_PAGE_INFO',\n  UPDATE_WALLET = 'UPDATE_WALLET',\n  UPDATE_DOMAIN = 'UPDATE_DOMAIN',\n  ACTION_FAIL = 'ACTION_FAIL',\n  LOAD_STATE = 'LOAD_STATE',\n  CHOICES_BNS_ACTION = 'CHOICES_BNS_ACTION'\n}\n\nexport type Dispatch = React.Dispatch<I_Action>\n\nexport interface I_Action {\n  type: ActionTypes\n  payload: any\n}\n\nexport interface I_State {\n  network: string\n  alias: string\n  extension: string\n  domain: I_Domain\n  wallet: {\n    address: string\n    mnemonic: string\n    WIF: string\n    txHistory:  Array<I_TX>\n    utxoList: Array<I_UTXO>\n  }\n  chain: {\n    height: number\n  }\n  choices: {\n    action: I_Action_Choice | {}\n    feeRate: number\n    txHex: string\n    embedString: string\n  }\n  pageInfo: {\n    current: number\n    checkedDomain: boolean\n    checkedWallet: boolean\n    checkedLightSearch: boolean\n  }\n  lastTimeStamp: number\n}\n","import React from 'react'\nimport styles from './RoundButton.module.css'\n\n/**\n * Standard button for this app.\n *\n * Pass the following props to customize it.\n *\n * next='true' to add next arrow at right (off if undefined or '').\n *\n * back='true' to add back arrow on left (off if undefined or '').\n *\n * show='true' to display element vs show='false' to set display to none (dom still exists).\n *\n * sizebutton='2.9' to make the button size 2.9x standard var(--s) size used (defined in global global.css).\n *\n * colorbutton='var(--colorBitcoinOrange)' to customize color.\n *\n * colorbuttonText='var(--colorButtonText)' to customize text color.\n *\n * Defaults (vars defined in global global.css):\n *\n * sizebutton = 2.5. ( means font size calc(2.5/2.9 * var(--s)) )\n *\n * colorbutton = var(--colorBitcoinOrange).\n *\n * colorbuttontext = var(--colorButtonText).\n */\nexport const RoundButton = (props:any): JSX.Element => {\n  return (\n    <div\n      // variables defined by string will be available to button & its children for scope\n      style={ {\n        display: (\n          (props?.show === 'false') ? 'none' : 'inline-block'\n        ) as React.CSSProperties,\n        '--colorThisButton': (\n          props.colorbutton ? props.colorbutton : `var(--colorBitcoinOrange)`\n        )  as React.CSSProperties,\n        '--colorThisButtonText': (\n          props.colorbuttontext ? props.colorbuttontext : `var(--colorButtonText)`\n        ) as React.CSSProperties,\n        '--sizeButton': (\n          props.sizebutton\n          // Button was designed at 2.9 * var(--s) scale font so\n          // this just lets user redefine font & everything else proportionally\n            ? `calc(${props.sizebutton}/2.9 * var(--s))`\n            : `calc(2.5/2.9 * var(--s))`\n        ) as React.CSSProperties\n      } }\n      className={ [\n        styles.roundButtonWrap,\n        props.back ? styles.back : undefined\n      ].join(' ') }\n      {...props}\n    >\n      <div\n        className={ [\n          styles.roundButton,\n          props.back ? styles.backArrow : undefined,\n          props.next ? styles.nextArrow : undefined,\n        ].join(' ') }\n      >\n        { props.children }\n        <div\n          className={ styles.overhead }\n        ></div>\n      </div>\n    </div>\n  )\n}\n","import { I_State, I_Action, ActionTypes } from '../../interfaces'\nimport { initialState } from './../'\nconst {\n  STORE_SEARCH_RESULTS_FAIL,\n  STORE_SEARCH_RESULTS,\n  TYPING,\n  NEW_WALLET,\n  CHANGE_PAGE_INFO,\n  UPDATE_WALLET,\n  UPDATE_DOMAIN,\n  ACTION_FAIL,\n  LOAD_STATE,\n  CHOICES_BNS_ACTION\n} = ActionTypes\n\n/**\n * Reducer edits global state via information in payload.\n * Action is object { payload, type }.\n * type describes what type of changes to global state to make.\n * payload contains data provided to make those changes.\n */\nexport default function reducer (state: I_State, action: I_Action): I_State {\n  const { payload } = action\n\n  switch (action.type) {\n\n    case CHOICES_BNS_ACTION: {\n      // BNS action chosen\n      return {\n        ...state,\n        choices: {\n          ...state.choices,\n          ...payload\n        },\n        lastTimeStamp: Date.now()\n      }\n    }\n\n    case UPDATE_WALLET: {\n      // after full scan of the wallet address\n      return {\n        ...state,\n        wallet: {\n          ...state.wallet, // wif/mnemonic/address unchanged\n          txHistory: payload.wallet.txHistory,\n          utxoList: payload.wallet.utxoList\n        },\n        pageInfo: {\n          ...state.pageInfo,\n          checkedWallet: true\n        },\n        lastTimeStamp: Date.now()\n      }\n    }\n\n    case UPDATE_DOMAIN: {\n      return {\n        ...state,\n        domain: {\n          ...payload.domain\n        },\n        chain: {\n          height: payload.chain.height\n        },\n        pageInfo: {\n          ...state.pageInfo,\n          checkedDomain: true\n        },\n        lastTimeStamp: Date.now()\n      }\n    }\n\n    case CHANGE_PAGE_INFO:\n      // navigation info for controlling domains\n      return {\n        ...state,\n        pageInfo: {\n          ...state.pageInfo,\n          current: payload\n        }\n      }\n\n    case NEW_WALLET: {\n      // store totally new wallet object\n      return {\n        ...state,\n        wallet: {\n          ...initialState.wallet,\n          address: payload.address,\n          mnemonic: payload.mnemonic,\n          WIF: payload.WIF\n        },\n        pageInfo: {\n          ...state.pageInfo,\n          checkedWallet: false\n        },\n        lastTimeStamp: Date.now()\n      }\n    }\n\n    case STORE_SEARCH_RESULTS: {\n      // store results of looking up totally new alias\n      // update notifications and ownership information\n\n      return {\n        ...state,\n        alias: payload.alias,\n        domain: {\n          ...initialState.domain,\n          ...payload.domain\n        },\n        chain: {\n          height: payload.chain.height\n        },\n        pageInfo: {\n          ...state.pageInfo,\n          checkedDomain: false,\n          checkedLightSearch: true\n        },\n        lastTimeStamp: Date.now()\n      }\n    }\n\n    case STORE_SEARCH_RESULTS_FAIL: {\n      // store results of looking up totally new alias\n      // reset notifications and ownership information\n      return {\n        ...state,\n        alias: payload.alias,\n        domain: {\n          ...initialState.domain,\n          domainName: payload.domainName,\n          notificationAddress: payload.notificationAddress\n        },\n        pageInfo: {\n          ...state.pageInfo,\n          checkedDomain: false,\n          checkedLightSearch: false\n        },\n        lastTimeStamp: Date.now()\n      }\n    }\n\n    case TYPING: {\n      // change of alias part of domain name\n      // this change renders owner and notification information outdated\n      return {\n        ...state,\n        alias: payload,\n        domain: initialState.domain,\n        pageInfo: {\n          ...state.pageInfo,\n          current: 1,\n          checkedDomain: false,\n          checkedLightSearch: false\n        },\n        lastTimeStamp: Date.now()\n      }\n    }\n\n    case ACTION_FAIL: {\n      return {\n        ...state,\n        lastTimeStamp: Date.now()\n      }\n    }\n\n    case LOAD_STATE: {\n      return {\n        ...payload,\n        lastTimeStamp: Date.now()\n      }\n    }\n\n    default: {\n      console.warn('Unknown action type')\n      return state\n    }\n  }\n}\n\n// can split maybe like this later if gets too long\n// https://dev.to/vanderleisilva/global-state-management-with-react-hooks-and-context-5f6h\n\n","import React from 'react'\nimport { I_State } from '../interfaces'\nimport reducer from './reducers/Reducer'\n\n// Change state process:\n// 1. Component calls action from src/store/actions/\n// 2. Action does stuff (e.g. API calls) and dispatches results to reducer in src/store/reducer/\n// 3. Reducer modifies state based on dispatched payload and type of action.\n\n// initial state\n// (changes to design need to be matched in reducers & interfaces)\nexport const initialState: I_State = {\n  network: 'testnet',             // 'testnet' or 'bitcoin'\n  alias: 'satoshi',               // first half of domain name\n  extension: '.btc',              // last half of domain name\n  domain: {                       // domain info from notifications\n    domainName: '',\n    notificationAddress: '',      // p2wsh address for this domain name (alias + extension)\n    txHistory: [],                // array of all tx for this address (old addressHistory)\n    derivedUtxoList: [],          // calculated utxo set from txHistory parse\n    utxoList: [],                 // array of all real time utxo for this address\n    users: {},                    // object with all interacting users\n    currentOwner: '',             // address of user that controls domain\n    bidding: {},                  // bidding info\n    ownersHistory: []             // history of ownership\n  },\n  wallet: {                       // wallet information & utxo for controlling domain names\n    address: '',                  // public address (p2wpkh)\n    mnemonic: '',                 // mnemonic for private key derivation\n    WIF: '',                      // wallet import format for private key derivation\n    txHistory: [],                // array of all tx for this address\n    utxoList: [],                 // array of all current utxo for this address\n  },\n  chain: {\n    height: 0                     // height of blockchain\n  },\n  pageInfo: {                     // user navigation information for controlling domain name\n    current: 1,\n    checkedDomain: false,         // current domain notification address was scanned\n    checkedWallet: false,         // current wallet address was scanned\n    checkedLightSearch: false     // if light search was done (no utxo / txhex scan)\n  },\n  choices: {                      // choices made by user via this app\n    action: [],                   // choices and data for action to take\n    feeRate: 1.1,                 // fee rate to use in sat/bByte,\n    txHex: '',                    // hex of raw transaction, ideally ready for broadcast\n    embedString: ''               // string to embed in op_return\n  },\n  lastTimeStamp: Date.now(),      // last change timestamp, to detect any changes to state or time out\n}\n\n// helper methods\nexport const getOwner = (st: I_State) => {\n  const ownerAddress = st.domain.currentOwner\n  return st.domain.users[ownerAddress]\n}\n\nexport const getUser = (st: I_State, address: string) => {\n  return st.domain.users[address]\n}\n\nexport const Store = React.createContext<any>(initialState)\n// returns object with .Provider and .Consumer\n// Provider makes state available to all child components no matter how deep\n\n\n\n// creates wrapping element for global state\nexport function StoreProvider ({ children }: JSX.ElementChildrenAttribute): JSX.Element {\n  const [state, dispatch] = React.useReducer(reducer, initialState)\n\n  return (\n    <Store.Provider value={{ state, dispatch }}>\n      { children }\n    </Store.Provider>\n  )\n}\n","/**\r\n * Takes in a string of interest inputString\r\n * and Array of strings or string describing filter.\r\n * Returns the string of interst with only characters present in filters selected.\r\n */\r\nexport default function  sanitize (inputString, stringOrArray) {\r\n  // get choice input into same form of array of string(s) of choices\r\n  let choices; // :string | Array<string>\r\n  if (Array.isArray(stringOrArray)) {\r\n    choices = stringOrArray;\r\n  }\r\n  if (typeof stringOrArray === 'string') {\r\n    choices = [stringOrArray];\r\n  }\r\n\r\n  // add each choice to filter selection\r\n\r\n  // string mask\r\n  let filter = '';\r\n  // array of functions\r\n  const logicFilters = [];\r\n\r\n  choices.forEach(choice => {\r\n\r\n    // short masks\r\n    if (choice === 'numbers') {\r\n      filter += '0123456789';\r\n    }\r\n    if (choice === 'decimal_point') {\r\n      filter += '.';\r\n    }\r\n    if (choice === 'hex') {\r\n      filter += '0123456789abcdefABCDEF';\r\n    }\r\n    if (choice === 'lowcaps') {\r\n      filter += 'abcdefghijklmnopqrstuvwxyz';\r\n    }\r\n    if (choice === 'highcaps') {\r\n      filter += 'ABCDEFGHIJKLMNOPQRSTUVWYZ';\r\n    }\r\n    if (choice === 'spaces') {\r\n      filter += ' ';\r\n    }\r\n\r\n    // longer masks\r\n    if (choice === 'base58') {\r\n      // https://en.wikipedia.org/wiki/Base58#cite_note-3\r\n      filter += '12345689ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz';\r\n    }\r\n    if (choice === 'basic') {\r\n      filter += '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\r\n    }\r\n    if (choice === 'oneline') {\r\n      filter += '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ,./-_!`~[]{}|@#%^&()-=?$';\r\n    }\r\n    if (choice === 'url') {\r\n      //  RFC 3986 (Section 2: Characters) 84 total\r\n      filter += `0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ:/?#[]@!$&'()*+,;=-_.~`;\r\n    }\r\n\r\n    // ========================================================\r\n    // functions\r\n    // adds anon function to array of functions\r\n\r\n    if (choice === 'no_spaces') {\r\n      logicFilters.push(str =>\r\n        str.split('')\r\n          .filter(letter => letter !== ' ')\r\n          .join(''))\r\n    }\r\n\r\n    if (choice === 'single_space_width') {\r\n      logicFilters.push(str =>\r\n        // split by 2+ spaces and replace with single space\r\n        str.split(/  */).join(' ')\r\n      )\r\n    }\r\n\r\n    // keep only first decimal point\r\n    if (choice === 'decimal_point') {\r\n\r\n      logicFilters.push(str =>\r\n        (str\r\n          // splits to array between .\r\n          .split('.')\r\n          // join first 2 elements with ., others with empty string\r\n          // returns a string\r\n          .reduce((resultingString, numbers, index) => {\r\n            // real . goes b/w array's index 0 and 1, even if string had . first\r\n            const digits = (index === 0 && numbers === '') ? '0' : numbers\r\n            return (index === 1)\r\n              ? [ resultingString, digits ].join('.')\r\n              : [ resultingString, digits ].join('')\r\n          }, '')\r\n        )\r\n      )\r\n    }\r\n\r\n    if (choice === 'no_leading_zeros') {\r\n\r\n      logicFilters.push(str =>\r\n        (str\r\n          // splits to array between .\r\n          .split('.')\r\n          .map((numbers, index) => {\r\n            if (index === 0) {\r\n              return (parseInt(numbers, 10) || 0).toString()\r\n            } else {\r\n              return numbers\r\n            }\r\n          })\r\n          .join('.')\r\n        )\r\n      )\r\n    }\r\n\r\n  })\r\n\r\n  if (filter.length === 0 && logicFilters.length === 0) {\r\n    console.warning('sanitize used w/o any known filters', stringOrArray)\r\n  }\r\n\r\n  let outputString = '';\r\n\r\n  // apply string mask to only keep characters within filter string\r\n  outputString = inputString\r\n    .split('')\r\n    .filter(letter => filter.indexOf(letter) > -1)\r\n    .join('');\r\n\r\n  // use every selected logic function on the outputString\r\n  logicFilters.forEach(fn => outputString = fn(outputString))\r\n\r\n  return outputString;\r\n}\r\n\r\n\r\n// function sanitizeOld (inString, type) {\r\n//   let filter;\r\n//   if (type === 'base58') {\r\n//     // https://en.wikipedia.org/wiki/Base58#cite_note-3\r\n//     filter = '123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz';\r\n//   } else if (type === 'hex') {\r\n//     filter = '0123456789abcdef';\r\n//   } else if (type === 'basic') {\r\n//     filter = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\r\n//   } else if (type === 'numbers') {\r\n//     filter = '0123456789';\r\n//   } else if (type === 'fractions') {\r\n//     filter = '0123456789.';\r\n//   } else if (type === 'oneline') {\r\n//     filter = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ,./-_!`~[]{}|@#%^&()-=?$';\r\n//   } else if (type === 'url') {\r\n//     filter = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ./-_';\r\n//   } else {\r\n//     console.log('sanitize: valid type not provided');\r\n//     return undefined;\r\n//   }\r\n\r\n//   const res = inString\r\n//     .split('')\r\n//     .filter(letter => filter.indexOf(letter) > -1)\r\n//     .join('');\r\n\r\n//   return res;\r\n// }","import { I_State, Dispatch } from '../../interfaces'\nimport sanitize from '../../helpers/sanitize'\nimport { ActionTypes } from './../../interfaces'\nconst { TYPING } = ActionTypes;\n\n/**\n * Cleans up the entered string including removing next line characters\n */\nexport const changeAliasAction = async (state: I_State, dispatch: Dispatch, value: any) => {\n  // clean up the string\n  const newString = value\n  const sanitizedString = sanitize(newString, 'url')\n\n  return dispatch({\n    type: TYPING,\n    payload: sanitizedString\n  })\n}\n","import {\n  I_BnsState,\n  BNSActions,\n  I_BNS_Action,\n  I_BNS_Auto_Action,\n  I_Condition,\n  I_TX\n} from './../types/'\nimport { MIN_NOTIFY, MIN_BURN } from './../constants'\nimport {\n  existsCurrentOwner,\n  isOwnerExpired,\n  clearOwner,\n  getParsedHeight,\n  atLeastTwoOutputs,\n  isNotify,\n  isOpreturnOutput0,\n  didNotifyMin,\n  didBurnMin,\n  setOwner,\n  getOwner,\n  getUser,\n  getTxInput0SourceUserAddress,\n  getTxHeight,\n  getTxTimestamp,\n  getTxOutput0BurnValue,\n  isAddressTheCurrentOwner,\n  burnedPreviousRateMin,\n  readEmbeddedData,\n  getLastOwnerBurnedValue,\n  isSenderTheCurrentOwner,\n  updateUtxoFromTx,\n  noUnspentUserNotificationsUtxo,\n  getNotificationAddress\n} from './../formathelpers'\nconst { RENEW, ONLY_FORWARDS, CLAIM_OWNERSHIP } = BNSActions\n\n// =========== CONDITIONS / PERMISSIONS ================\n// Called by the actions for conditions\n// Return object with \"info\": describing condition (accessible w/o tx),\n// \"status\" to check conditoin (accessible w/o tx),\n// and optional \"special\" to give transaction forming specifications (accessible w/o tx)\n\nconst OUTS_2 = ({ tx=undefined }: any): I_Condition => ({\n  info: 'Tx must have 2+ outputs',\n  status: () => atLeastTwoOutputs(tx)\n})\n\nconst OUT_0 = ({ tx=undefined }: any): I_Condition => ({\n  info: 'Tx must have OP_RETURN @ output[0]',\n  status: () => isOpreturnOutput0(tx)\n})\n\nconst OUT_1 = ({ st, tx=undefined }: any): I_Condition => ({\n  info: 'Tx must have notification address @ output[1]' ,\n  status: () => isNotify(st, tx)\n})\n\nconst NOTIFIED_MIN = ({ tx=undefined }: any): I_Condition => ({\n  info: `Tx must have minimum ${MIN_NOTIFY} @ output[1]`,\n  status: () => didNotifyMin(tx)\n})\n\nconst BURNED_MIN = ({ tx=undefined }: any): I_Condition => ({\n  info: `Tx must burn ${MIN_BURN} @ output[0]`,\n  status: () => didBurnMin(tx),\n  special: { output0value: MIN_BURN }\n})\n\nconst NO_OWNER = ({ st }: any): I_Condition => ({\n  info: 'There must not be an existing owner',\n  status: () => !existsCurrentOwner(st)\n})\n\nconst EXISTS_OWNER = ({ st }: any): I_Condition => ({\n  info: 'There must be existing owner',\n  status: () => existsCurrentOwner(st)\n})\n\nconst BURN_LAST_WIN = ({ st, tx=undefined }: any): I_Condition => ({\n  info: 'Tx must burn the last ownership winning burn amount',\n  status: () => burnedPreviousRateMin(st, tx),\n  special: { output0value: getLastOwnerBurnedValue(st) }\n})\n\n// calculated based on tx if available, otherwise address\nconst USER_IS_OWNER = ({ st, address, tx=undefined }: any): I_Condition => ({\n  info: `User's address must match owner's address`,\n  status: () => tx ? isSenderTheCurrentOwner(st, tx) : isAddressTheCurrentOwner(st, address)\n})\n\nconst IS_OWNER_EXPIRED = ({ st }: any): I_Condition => ({\n  info: 'Ownership must be expired at current parsed height',\n  status: () => isOwnerExpired(st)\n})\n\nconst NO_UNSPENT_USER_NOTIFICATIONS_UTXO = ({ st, tx=undefined }: any): I_Condition => ({\n  info: 'There must not be any remaining notification address utxo created by sender',\n  status: () => noUnspentUserNotificationsUtxo(st, tx),\n  special: { inputs: 'NO_USER_NOTIFICATION_UTXO' }\n})\n\nconst USER_ADDRESS_NOT_NOTIFICATION_ADDRESS = ({ st, tx=undefined }: any): I_Condition => ({\n  info: 'Do not accidentally send from notification address at input[0]',\n  status: () => (getNotificationAddress(st) !== getTxInput0SourceUserAddress(tx))\n})\n\n\n// ============ USER ACTIONs ===============\n\n// Describe: If no owner, sender can claim ownership\nexport const claimOwnershipAction = (st: I_BnsState, tx: any = undefined): I_BNS_Action => {\n  const args = { st, tx }\n  return {\n\n    type: CLAIM_OWNERSHIP,\n    info: 'Claim ownership of an available domain',\n\n    permissions: [\n      NO_OWNER(args)\n    ],\n\n    conditions: [\n      OUTS_2(args),\n      OUT_0(args),\n      OUT_1(args),\n      NOTIFIED_MIN(args),\n      USER_ADDRESS_NOT_NOTIFICATION_ADDRESS(args),\n\n      BURNED_MIN(args),\n      NO_UNSPENT_USER_NOTIFICATIONS_UTXO(args)\n    ],\n\n    execute: () => {\n\n      if (tx.txid === 'a15e75716d9c035a61d4d1597f459d7193719caeccc04828a186db603476276b') {\n        console.log('ownership part of claimOwnershipAction executed for last tx')\n      }\n\n\n      // ownership source was already created for sure via updateSourceUserFromTx\n      // only have to set owner address to tx address\n      const height = getTxHeight(tx)\n      const senderAddress =  getTxInput0SourceUserAddress(tx)\n      setOwner(st, senderAddress)\n      getUser(st, senderAddress).winHeight = height\n      getUser(st, senderAddress).winTimestamp = getTxTimestamp(tx)\n      getUser(st, senderAddress).burnAmount = getTxOutput0BurnValue(tx)\n      console.log(\n        `${ st.domain.domainName } : ${ getTxHeight(tx) } height: new owner is ${ getUser(st, senderAddress).address }`\n      )\n    }\n  }\n}\n\n\n// Describe: If from current owner & burned past winning minimum, extend ownership.\nexport const currentOwnerRenewAction = (\n  st: I_BnsState,\n  address: string = '',\n  tx: any = undefined\n): I_BNS_Action => {\n  const args = { st, address, tx }\n  return {\n\n    type: RENEW,\n    info: 'Extend ownership of this domain',\n\n    permissions: [\n      USER_IS_OWNER(args)\n    ],\n\n    conditions: [\n      OUTS_2(args),\n      OUT_0(args),\n      OUT_1(args),\n      NOTIFIED_MIN(args),\n      USER_ADDRESS_NOT_NOTIFICATION_ADDRESS(args),\n\n      BURNED_MIN(args),\n      BURN_LAST_WIN(args),\n      NO_UNSPENT_USER_NOTIFICATIONS_UTXO(args)\n    ],\n\n    execute: () => {\n      const owner = getOwner(st)\n      // set owner's win height to current tx height therefore updating ownership\n      owner && (owner.winHeight = getTxHeight(tx))\n      owner && (owner.winTimestamp = getTxTimestamp(tx))\n      console.log(\n        `${ st.domain.domainName } : ${ getTxHeight(tx) } height: owner extended ownership ${ owner?.address }`\n      )\n    }\n  }\n}\n\n// Describe: update forwarding information.\nexport const updateForwardingInfoAction = (\n  st: I_BnsState,\n  address: string = '',\n  tx: any = undefined\n): I_BNS_Action => {\n  const args = { st, address, tx }\n  return {\n\n    type: ONLY_FORWARDS,\n\n    info: 'Only update forwarding information',\n\n    permissions: [],\n\n    conditions: [\n      OUTS_2(args),\n      OUT_0(args),\n      OUT_1(args),\n      NOTIFIED_MIN(args)\n    ],\n\n    execute: () => {\n      readEmbeddedData(st, tx)\n    },\n\n    // Change info to warning when attempting to update forwarding info\n    // for domain you do not control.\n    // Such a change would be wasted until it's owned.\n    warning:\n      !USER_IS_OWNER(args).status()\n        ? 'Warning: not your domain yet!'\n        : undefined\n  }\n}\n\n// =========== AUTOMATIC PARSED ACTIONS NOT BY USERS (e.g. TIME BASED) ===========\n\n// Describe: if OWNERSHIP_DURATION_BY_BLOCKS blocks since ownership update, no owner again\nexport const autoCheckForOwnerExpiredAction = (st: I_BnsState): I_BNS_Auto_Action => {\n  const args = { st }\n  return {\n    info: 'Existing ownerships that expire are removed',\n\n    conditions: [\n      EXISTS_OWNER(args),\n      IS_OWNER_EXPIRED(args)\n    ],\n\n    execute: () => {\n      clearOwner(st)\n      console.log(st.domain.domainName, getParsedHeight(st), 'ownership expired')\n    }\n  }\n}\n\n// Describe: always uses this tx to update derivedUtxoList of the domain notificatin address\nexport const updateUtxoFromTxAction = (st: I_BnsState, tx: I_TX): I_BNS_Auto_Action => {\n  return {\n    info: 'Update derivedUtxoList from new tx',\n\n    conditions: [],\n\n    execute: () => {\n      updateUtxoFromTx(st, tx)\n    }\n  }\n}","import {\n  currentOwnerRenewAction,\n  claimOwnershipAction,\n  autoCheckForOwnerExpiredAction,\n  updateForwardingInfoAction,\n  updateUtxoFromTxAction\n} from './actions'\nimport { I_BnsState, I_TX, I_Condition } from './../types/'\n// import {\n//   getTxInput0SourceUserAddress\n// } from './../formathelpers'\n\n/****************************************************************************************\n * Returns what actions are available for specific user address at current state\n */\nexport const runAllActionPermissionChecks = (st: I_BnsState, address: string) => {\n  console.log('currentOwnerRenewAction running:')\n\n  // Edit this list to include more actions for checks\n  const allActions = [\n    updateForwardingInfoAction(st, address),\n    currentOwnerRenewAction(st, address),\n    claimOwnershipAction(st)\n  ]\n\n  // check which actions are doable\n  const checkedActions: any[] = []\n  allActions.forEach(action => {\n\n    // check each permission in each action\n    const checkedPermissions: any[] = []\n    action.permissions.forEach((permission: any) => {\n      const isAllowed = permission.status()\n\n      // add to list of permissions checked in this action & their display info\n      checkedPermissions.push({\n        isAllowed,\n        info: permission.info\n      })\n    })\n\n    // grab every special rule so can put together tx based on them\n    const specialTxDirections: any[] = []\n    action.permissions.forEach((permission: any) => {\n      if ('special' in permission) specialTxDirections.push({\n        info: permission.info,\n        rules: permission.special\n      })\n    })\n    action.conditions.forEach((condition: any) => {\n      if ('special' in condition) specialTxDirections.push({\n        info: condition.info,\n        rules: condition.special\n      })\n    })\n\n\n    // add to list of all actions with summary of all their permissions checks\n    checkedActions.push({\n      type: action.type,\n      info: action.info,\n      isUsable: checkedPermissions.every(permission => permission.isAllowed),\n      warning: action.warning,\n      permissionList: checkedPermissions,\n      special: specialTxDirections\n    })\n  })\n\n  // return array of doable actions\n  return checkedActions\n}\n\n/****************************************************************************************\n * Executes all actions possible by user that sent tx.\n * Nothing returned.\n */\nexport const runAllUserActions = (st: I_BnsState, tx: I_TX) => {\n\n  // edit this list\n  const allUserActions = [\n    updateForwardingInfoAction(st, undefined, tx),\n    currentOwnerRenewAction(st, undefined, tx),\n    claimOwnershipAction(st, tx)\n  ]\n\n  allUserActions.forEach((action: any) => {\n\n    // check that all conditions & permissions are true\n    const okConditions = action.conditions.reduce(\n      (areAllConditionsMet: boolean, eaCondition: any) => areAllConditionsMet && eaCondition.status()\n    , true)\n\n    const okPermissions = action.permissions.reduce(\n      (areAllPermissionsMet: boolean, eaPermission: any) => areAllPermissionsMet && eaPermission.status()\n    , true)\n\n    if (okConditions && okPermissions) action.execute()\n  })\n}\n\n/****************************************************************************************\n * Executes non-user actions like ownership expiration over time or deriving new UTXO.\n * Nothing returned.\n */\nexport const runAllAutomaticActions = (st: I_BnsState, tx: I_TX | undefined) => {\n\n  // list of all automatic actions\n  const allAutoChecks = [\n    autoCheckForOwnerExpiredAction(st),\n    tx ? updateUtxoFromTxAction(st, tx) : undefined\n  ]\n\n  allAutoChecks.forEach(action => {\n    if (!!action) {\n      // check that all conditions are true\n      const ok = action.conditions.reduce(\n        (areAllConditionsMet: boolean, eaCondition: I_Condition ) => (\n          areAllConditionsMet && eaCondition.status()\n        ), true)\n      if (ok) action.execute()\n    }\n  })\n}\n\n\n","import { calcP2WSH } from './calcP2WSH'\nimport { newState } from './initialState'\nimport * as actions from './actions'\nimport { I_BnsState } from './types'\nimport {\n  setParsedHeight,\n  updateSourceUserFromTx,\n  getTxHeight,\n  updateOwnerHistory\n } from './formathelpers'\n\n/**\n * Returns ownership and notification information objects.\n * @param   {Array<any>}  notificationsHistory  - Array of any tx with notificationsAddress.\n * @param   {string}      domainName            - Full domainName to use (e.g. 'satoshi.btc').\n * @param   {number}      currentHeight         - Current blockheight of the network chain selected.\n * @param   {string}      networkChoice         - 'testnet' or 'bitcoin' (matches bitcoinjs-lib).\n * @returns {I_BnsState}                         - BNS state describing object.\n */\nexport const calcBnsState = (\n  notificationsHistory: Array<any>,\n  domainName: string,\n  currentHeight: number,\n  networkChoice: string\n): I_BnsState => {\n\n  // initialize temporary derivation state\n  const st = JSON.parse(JSON.stringify(newState)); // deep object clone\n  st.domain.domainName = domainName\n  st.chain && (st.chain.currentHeight = currentHeight)\n  st.domain.notificationAddress = calcP2WSH(domainName, networkChoice)?.notificationsAddress || ''\n\n  // Sorting history from earliest to latest\n  // reversing should speed it up if not complete it\n  st.domain.txHistory = (notificationsHistory\n    .slice().reverse()\n    .sort((prev, next) => {\n      const prevBlockHeight = prev.status.block_height\n      const nextBlockHeight = next.status.block_height\n      return prevBlockHeight - nextBlockHeight\n    })\n  )\n\n  // iterate with blockheights of relevant tx to derive st state\n  // Each tx blockheight serves as reference time\n  st.domain.txHistory.forEach((tx: any) => {\n\n    // update current chain's parsed height based on tx confirmed height\n    setParsedHeight(st, getTxHeight(tx))\n\n    // update or create new basic user info based on source address @ input0\n    // this includes user's NONCE set to height of the user's tx prior to this one\n    updateSourceUserFromTx(st, tx)\n\n    // check if owner expired & update derivedUtxo\n    actions.runAllAutomaticActions(st, tx)\n\n    // run all possible actions\n    // starting with reading embedded data\n    actions.runAllUserActions(st, tx)\n\n    // update nonce\n    // after this tx, this tx height is the last tx height, so the new nonce\n    updateSourceUserFromTx(st, tx)\n\n    // update ownership history each tx even if not owner\n    updateOwnerHistory(st)\n  })\n\n  // final check for current block height\n  setParsedHeight(st, currentHeight)\n\n  // check if owner expired\n  actions.runAllAutomaticActions(st, undefined)\n\n  return st\n}\n\n","import { I_Forward } from '../types'\n/**\n * Returns array with only latest forwards from array of all forwards.\n * Removes actions, ones that start with \"!\" and ones that are blank addresses.\n */\nexport const findLatestForwards = (forwards: Array<I_Forward>): Array<I_Forward> => {\n  // simplest would be to go through object where keys of cloned network would overwrite\n  // sort first for simplicity\n  const sortedForwards = [...forwards].sort((prev, next) => {\n    // sorts by index proportional to block height and time\n    const prevHeight = prev.updateHeight\n    const nextHeight = next.updateHeight\n    return prevHeight - nextHeight\n  })\n  // now just overwrite values for same networks in order of sorted array\n  const currentNetworks: {[key: string]: I_Forward} = {}\n  sortedForwards.forEach(eaForward => {\n    // add all networks that are not commands\n    const isNotCommand = !eaForward.network.startsWith('!')\n    if (isNotCommand) {\n      currentNetworks[eaForward.network] = eaForward\n    }\n    // if the final address is blank, delete it from object\n    const isDeleted = eaForward.address === ''\n    if (isDeleted) {\n      delete currentNetworks[eaForward.network]\n    }\n  })\n\n  // return just array of values, networks still part of values as well\n  return [...Object.values(currentNetworks)]\n}\n","import { encrypt } from './cryptography'\n\n/**\n * Returns number of bytes the string has after encryption.\n * Encryption is used directly to measure result accurately\n * even if cryption method changes in the future.\n */\nexport const stringByteCount = (data: string): number => {\n  const cipher: Buffer = encrypt(data, 'arbitrary key and iv seeding string')\n  // returns buffer, so length should be bytesize\n  return cipher.length;\n}","import axios from 'axios'\n\n// Documentation\n// https://github.com/Blockstream/esplora/blob/esplora_v2.00/API.md\n// https://github.com/Blockstream/esplora/blob/master/API.md#post-tx\n\nconst API_PATH_TESTNET = 'https://blockstream.info/testnet/api/'\nconst API_PATH_BITCOIN = 'https://blockstream.info/api/'\nconst API_RATE_LIMIT = 0.6    // guessing calls per second cap\n\n// (TODO) a single instance of async task executing loop per API to ensure rate limit holds per API\n// Meanwhile calling function can use its own busy flag to ensure promises are resolved before repeats.\n// RawTx requests and multipage history (length > 25) are main risks.\n\nexport async function getFeeEstimates (strNetwork: string) {\n  const API_PATH = (\n    (strNetwork === 'testnet')\n    ? API_PATH_BITCOIN // only main chain fee estimate for better testing\n    : API_PATH_BITCOIN\n  ) + 'fee-estimates'\n\n  try {\n\n    const res = await axios.get(API_PATH)\n    console.log('getFeeEstimates', res.data)\n\n    // await rateLimit()\n\n    return res.data\n\n  } catch (e) {\n\n    console.log(e)\n    await rateLimit()\n    throw new Error('Blockstream.info API getFeeEstimates failed')\n  }\n\n}\n\n\nexport async function getHeight (strNetwork: string) {\n  const API_PATH = (\n    (strNetwork === 'testnet')\n    ? API_PATH_TESTNET\n    : API_PATH_BITCOIN\n  ) + 'blocks/tip/height'\n  console.log(API_PATH)\n\n  try {\n\n    const res = await axios.get(API_PATH)\n    console.log('getHeight', res.data)\n\n    // await rateLimit()\n\n    return res.data\n\n  } catch (e) {\n\n    console.log(e)\n    await rateLimit()\n    throw new Error('Blockstream.info API height get failed')\n  }\n\n}\n\n/**\n * API request for each UTXO in array to get the raw tx necessary for psbt.\n * @param     {Array}     arrayUtxo       Array of UTXO.\n * @param     {string}    strNetwork      Network type: 'bitcoin' or 'testnet'.\n * @returns   {object}                    { arrayTx: arrayTx w/ .hex, error: string, fails: number }\n */\nexport async function addRawTxToArray (utxoList: Array<any>, strNetwork: string) {\n  // to track failures indecies\n  let erroredOutputs = ''\n\n  // abort if empty array\n  if (utxoList?.length === 0) {\n    return { utxoList, error: 'no utxo' }\n  }\n\n  // iterate through original utxo and add hex onto clone, 2 tries max each\n  for (const [indexString, utxo] of Object.entries(utxoList)) {\n    // indexString is a string so convert for array index use\n    const index = parseInt(indexString, 10)\n\n    let tries = 2\n    while (tries-- > 0) {\n      try {\n        const { txid } = utxo\n\n        // raw tx hex path on API\n        const API_PATH = (\n          (strNetwork === 'testnet')\n            ? API_PATH_TESTNET\n            : API_PATH_BITCOIN\n        ) + 'tx/' + txid + '/hex'\n        console.log(API_PATH)\n\n        const res = await axios.get(API_PATH)\n\n        console.log(index, 'index utxo has raw hex of', res.data)\n\n        // add hex data into cloned utxo array\n        utxoList[index].hex = res.data\n\n        // break while loop if got data, don't need more tries\n        break\n\n      } catch(e) {\n        // keeping track of failures\n        console.log('fail detected', indexString, utxo, tries, erroredOutputs, e)\n        // keep track of indecies missing hex\n        erroredOutputs += indexString + ' '\n      }\n\n      await rateLimit()\n    }\n  }\n\n  // return summary object\n  return { utxoList, erroredOutputs }\n}\n\n/**\n * API request for all utxo for this address.\n * Blockstream utxo do not have addresses that created them!\n * @param     {string}    address       Bitcoin address.\n * @param     {string}    strNetwork    Network type: 'bitcoin' or 'testnet'.\n * @returns   {Array}                   Array of UTXO.\n */\nexport async function getUTXOList (address: string, strNetwork: string) {\n  const API_PATH = (\n    (strNetwork === 'testnet')\n    ? API_PATH_TESTNET\n    : API_PATH_BITCOIN\n  ) + 'address/' + address + '/utxo'\n  console.log(API_PATH)\n\n  try {\n    const res = await axios.get(API_PATH)\n\n    console.log('getUTXOList', res.data)\n\n    await rateLimit()\n\n    return res.data\n\n  } catch (e) {\n\n    console.log(e)\n    await rateLimit()\n    throw new Error('Blockstream.info API access failed')\n\n  }\n}\n\n/**\n * API request all transactions for a specific address.\n * parameters: (address, network).\n * @param   {string} address    - address on network.\n * @param   {string} network    - 'testnet' or 'bitcoin' to match bitcoinjs-lib.\n * @returns {Array<object>}     -  Array of tx objects.\n */\nexport async function getAddressHistory (address: string, network: string) {\n  // https://blockstream.info/testnet/api/address/tb1qprkzdaqt5jkxrhy57ngvra8k0rvq63ulksz8cx85qwke3myhjrtq9s6nj3/txs/chain\n  // GET /address/:address/txs/chain[/:last_seen_txid]\n  // Get confirmed transaction history for the specified address/scripthash, sorted with newest first.\n  // Returns 25 transactions per page. More can be requested by specifying the last txid seen by the previous query.\n\n  const CONFIRMED_PAGES_ADDON = '/txs/chain'\n\n  const API_PATH = (\n    (network === 'testnet')\n    ? API_PATH_TESTNET\n    : API_PATH_BITCOIN\n  ) + 'address/' + address + CONFIRMED_PAGES_ADDON\n\n  try {\n    const res = await axios.get(API_PATH)\n\n    console.log('blockstream.info API address history request', res)\n    return res.data\n\n  } catch (e) {\n    console.log(e)\n    throw new Error('Blockstream.info API access failed')\n  }\n}\n\n/**\n * Broadcasts content onto the blockchain.\n * parameters: (content, network).\n * @param   {string}  content  - raw hex content of transaction.\n * @param   {string}  network  - 'testnet' or 'bitcoin' to match bitcoinjs-lib.\n * @returns {string}           - Successful broadcast returns txid, otherwise error reason.\n */\nexport async function txPush (content: string, network: string) {\n\n  const API_PATH =\n    (network === 'testnet')\n    ? API_PATH_TESTNET + 'broadcast'\n    : API_PATH_BITCOIN + 'broadcast'\n\n  try {\n    const res = await axios.get(API_PATH, {\n      params: {\n        tx: content\n      }\n    })\n\n    // console.log(res)\n    console.log('Broadcasted on', network)\n\n    // returns txid on success\n    return { txid: res.data }\n\n  } catch (e) {\n    console.log('Failed pushtx', network, e.response.data )\n\n    throw new Error('Blockstream.info API access failed\\n' + e.response.data)\n  }\n}\n\n// Slow down based on rate limit.\n// Convert hz to time in milliseconds.\nasync function rateLimit () {\n  return new Promise(r => setTimeout(r, 1000.0 / API_RATE_LIMIT))\n}\n","import { I_State, Dispatch, ActionTypes } from '../../interfaces'\nimport { calcP2WSH, calcBnsState } from '../../helpers/bns'\nimport { getAddressHistory, getHeight } from './../../api/blockstream'\nconst { STORE_SEARCH_RESULTS_FAIL, STORE_SEARCH_RESULTS } = ActionTypes;\n\n/**\n * Get address,\n * tx with notification address,\n * calculate owner,\n * find current owner's forwarding info,\n * send/dispatch to reducer to store important data found\n * (No UTXO nor raw TX scan for speed in front page search)\n */\nexport const searchAction = async (state: I_State, dispatch: Dispatch, router: any = undefined) => {\n  const domainName = state.alias + state.extension\n  // stop if no alias submitted, nothing to save to state\n  if (!state.alias) { return undefined }\n\n  // find address for this alias\n  const { notificationsAddress } = calcP2WSH(domainName, state.network)\n\n  // (TODO) should check if max length for API reached to know if to use pages & append value (25?)\n\n  try {\n\n    // 1. Get current blockheight from API so ownership is using latest possible info\n\n    const currentHeight = await getHeight(state.network)\n\n    // 2. Get API response for all tx history of this address\n    // This will grab all tx that \"notified\" this address by sending to it\n    // Upon failure error should be caught in this function\n    const notificationsTxHistory = await getAddressHistory(notificationsAddress, state.network)\n\n    // calculate bns data from this history via helper functions\n    const { domain } = calcBnsState(\n      notificationsTxHistory,\n      domainName,\n      currentHeight,\n      state.network\n    )\n\n    // 3. if navigated via id, use router to navigate home w/o id in url\n    if (router) { router?.push('/') }\n\n    // store data\n    return dispatch({\n      type: STORE_SEARCH_RESULTS,\n      payload: {\n        alias: state.alias,\n        domain,\n        chain: {\n          height: currentHeight\n        }\n      }\n    })\n\n  } catch (e) {\n    console.log(e)\n    // still updating the notification address\n    return dispatch({\n      type: STORE_SEARCH_RESULTS_FAIL,\n      payload: {\n        alias: state.alias,               // can save alias\n        domainName,\n        notificationsAddress              // can save this easy derivation\n      }\n    });\n  }\n}\n\n// test address tb1qprkzdaqt5jkxrhy57ngvra8k0rvq63ulksz8cx85qwke3myhjrtq9s6nj3\n// has mixture of tx sent to it on testnet\n// https://blockstream.info/testnet/address/tb1qprkzdaqt5jkxrhy57ngvra8k0rvq63ulksz8cx85qwke3myhjrtq9s6nj3","import { I_State, Dispatch } from '../../interfaces'\nimport { ActionTypes } from './../../interfaces'\n\nimport { createNewWallet, loadWallet } from '../../helpers/bns/bitcoin'\n\nconst { NEW_WALLET } = ActionTypes;\n\n/**\n * Create new wallet address & backup.\n * If mnemonic is provided, wallet is generated from that.\n */\nexport const createNewWalletAction = async (\n  state: I_State, dispatch: Dispatch, strMnemonic: string = ''\n) => {\n\n  // load all the wallet info from mnemonic or generate new random mnemonic to do it\n  const { mnemonic, WIF, address } = (\n    (strMnemonic === '')\n      ? createNewWallet(state.network)\n      : loadWallet(strMnemonic, state.network)\n  )\n\n  return dispatch({\n    type: NEW_WALLET,\n    payload: { mnemonic, WIF, address }\n  })\n}","import { I_State, Dispatch, ActionTypes } from '../../interfaces'\nconst { CHANGE_PAGE_INFO } = ActionTypes;\n\n\n/**\n * Request to change page info that's checked for validity here\n */\nexport const changePageInfoAction = async (state: I_State, dispatch: Dispatch, page: number) => {\n  // for now no checks\n\n  return dispatch({\n    type: CHANGE_PAGE_INFO,\n    payload: page\n  })\n}","import { I_State, Dispatch, ActionTypes } from '../../interfaces'\nimport { calcP2WSH, calcBnsState } from '../../helpers/bns'\nimport { getAddressHistory, getUTXOList, addRawTxToArray, getHeight } from '../../api/blockstream'\nconst { UPDATE_WALLET, UPDATE_DOMAIN, ACTION_FAIL } = ActionTypes\n\n/**\n * Scans the address for utxo on a given network (w/ API).\n * Add hex of each tx that created utxo (for psbt).\n * addressType is one of enums ActionTypes that's either UPDATE_WALLET or UPDATE_NOTIFICATION.\n * If scanning wallet, then update wallet state.\n * If scanning notification address, then update notification state.\n * Notification scan will reproduce address scan first before getting details.\n */\nexport const scanAddressFullyAction = async (\n  state: I_State,\n  dispatch: Dispatch,\n  addressType: ActionTypes\n) => {\n  const domainName = state.alias + state.extension\n\n  // wallet address scan\n  if (addressType === UPDATE_WALLET) {\n    // wallet address\n\n    try {\n\n      // 1. get address TX history\n\n      const walletAddress = state.wallet.address\n      const walletTxHistory = await getAddressHistory(walletAddress, state.network)\n\n      // 2. get address UTXO list (could also calculate from tx history or API)\n\n      const utxoListWalletAddress = await getUTXOList(walletAddress, state.network)\n\n      // 3. get raw tx for each UTXO (psbt requirement for creating new tx later)\n\n      const { utxoList, erroredOutputs } = await addRawTxToArray(utxoListWalletAddress, state.network)\n\n      !!erroredOutputs && console.log('API had issues during hex utxo scan:', erroredOutputs)\n\n      return dispatch({\n        type: UPDATE_WALLET,\n        payload: {\n          wallet: {\n            txHistory: walletTxHistory,\n            utxoList: utxoList\n          }\n        }\n      })\n\n    } catch (e) {\n      console.log('Wallet address scan failed')\n      console.log(e)\n      // abort\n      return dispatch({\n        type: ACTION_FAIL,\n        payload: {}\n      });\n    }\n  }\n\n  // notification address scan\n  if (addressType === UPDATE_DOMAIN) {\n\n\n    try {\n\n      // 1. get current blockheight from API so ownership is using latest possible info\n\n      const currentHeight = await getHeight(state.network)\n\n      // 2. get address TX history\n\n      const { notificationsAddress } = calcP2WSH(domainName, state.network)\n      const notificationsTxHistory = await getAddressHistory(notificationsAddress, state.network)\n\n\n      // 3. derive new BNS domain state & utxo\n      const { domain: newDomain } = calcBnsState(\n        notificationsTxHistory,\n        domainName,\n        currentHeight,\n        state.network\n      )\n\n\n      // 4. get raw tx for each UTXO (psbt requirement for creating new tx later)\n\n      const { erroredOutputs } = await addRawTxToArray(\n        newDomain.derivedUtxoList,\n        state.network\n      )\n\n      !!erroredOutputs && console.log('API had issues during hex utxo scan:', erroredOutputs)\n\n      return dispatch({\n        type: UPDATE_DOMAIN,\n        payload: {\n          domain: newDomain,\n          chain: {\n            height: currentHeight\n          }\n        }\n      })\n\n    } catch (e) {\n      console.log('Notification address scan failed')\n      console.log(e)\n      // abort\n      return dispatch({\n        type: ACTION_FAIL,\n        payload: {}\n      });\n    }\n\n  }\n\n  throw new Error('unexpected address type')\n}","import { I_State, Dispatch, ActionTypes } from '../../interfaces'\nconst { CHOICES_BNS_ACTION } = ActionTypes;\n\n/**\n * Cleans up the entered string including removing next line characters\n */\nexport const changeChoicesBNSAction = async (\n  state: I_State,\n  dispatch: Dispatch,\n  choices: any\n) => {\n\n  return dispatch({\n    type: CHOICES_BNS_ACTION,\n    payload: choices\n  })\n}\n\n","import React from 'react'\nimport { Store, getOwner } from './../../store'\nimport { Link } from 'react-router-dom'\n\nimport styles from './SearchResults.module.css'\nimport timeDiff from './../../helpers/timediff'\nimport { OWNERSHIP_DURATION_BY_BLOCKS, interpretFw, findLatestForwards } from '../../helpers/bns/'\n\n\nexport const SearchResults = () => {\n  // global state\n  const { state } = React.useContext(Store)\n\n  // temp object to keep track of timers\n  let diff = { isExpired: true, dh: '' }\n\n  // calc time left in ownership via block heights\n  const owner = getOwner(state)\n  if (owner) {\n    const heightOfExpiration = owner.winHeight + OWNERSHIP_DURATION_BY_BLOCKS\n    const blocksUntilExpires = (heightOfExpiration - state.chain.height)\n    const msUntilExpires = blocksUntilExpires * 10.0 * 60.0 * 1000.0\n    diff = timeDiff(msUntilExpires, 0)\n  }\n\n  // account expires or isExpired information\n  const expirationMsg = () => {\n    // abort if no known ownership history\n    if (!owner) return ('')\n    return (\n      <div\n        className={ diff.isExpired ? styles.expired : styles.notExpired }\n      >\n        { !diff.isExpired && ('expires in ' + diff.dh) }\n      </div>\n    )\n  }\n\n  // calculate latest forwards\n  const latestForwards = owner ? findLatestForwards(owner.forwards) : []\n\n  return (\n    <>\n      <div className={ styles.wrapper }>\n        <div\n          className={ styles.describe }\n        >\n          { latestForwards.length } matches on { state.network } {'  '}\n          { expirationMsg() }\n        </div>\n        <div className={ styles.listContainer } >\n          {(diff.isExpired) && (\n            <Link\n              to='/create'\n              className={ styles.createLink }\n            >\n              Domain available!\n            </Link>\n          )}\n        </div>\n        <div className={ styles.listContainer } >\n          {\n            latestForwards.map((fw: any) => {\n              const ifw = interpretFw(fw)\n              if (ifw.render) {\n                return (\n                  <a\n                    key={ fw.network }\n                    className={ styles.listItem }\n                    href={ encodeURI(ifw?.link || '') || undefined }\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                  >\n                    <span className={ styles.key }>{ ifw.where }</span>\n                    { ifw.what }\n                  </a>\n                )\n              } else {\n                return ('')\n              }\n            })\n          }\n        </div>\n      </div>\n    </>\n  )\n}\n","\n/**\n * Difference between timestampMsec timestamp relative to current time or another reference referenceTimestampMsec timestamp.\n * Returns days-hours-minutes string, days-hours string, if expired, and ms of difference.\n * @param   {number}  timestampMsec               Timestamp of interest (milliseconds).\n * @param   {number}  [referenceTimestampMsec=]   Reference timestamp (milliseconds).\n * @returns {object}                              { dhm, dh, isExpired, msDiff }.\n */\nexport default function timeDiff(\n  timestampMsec: number, referenceTimestampMsec: number = Date.now()\n): {\n  dhm: string\n  dh: string\n  isExpired: boolean\n  msDiff: number\n} {\n  let diff = timestampMsec - referenceTimestampMsec\n  // note sign\n  const isExpired = (diff <= 0)\n  // mod away higher time frames\n  diff = Math.abs(diff)\n  const d = Math.floor(diff / (1000 * 60 * 60 * 24))\n  // remove days\n  diff -= d * (1000 * 60 * 60 * 24)\n  const h = Math.floor(diff / (1000 * 60 * 60)) % 24\n  // remove hours\n  diff -= h * (1000 * 60 * 60)\n  const m = Math.floor(diff / (1000 * 60)) % 60\n  return {\n    dhm: `${d} days ${h} hours ${m} min`,\n    dh: `${d} days ${h} hours`,\n    isExpired,        // time difference is to the past of now? (boolean)\n    msDiff: diff\n  };\n}","import { I_Forward } from '../types'\n/**\n * Reads a single forward info object to interpret its values\n * as where the forwarding address should be used, what it is, and what link to use.\n * Returns {what: string, where: string, link: string, render: boolean}.\n */\nexport function interpretFw (fw: I_Forward) {\n  // blank address means it was removed\n  // ! at start means it's a command, not a network\n  if (fw.address === '' || fw.network.startsWith('!')) {\n    return {\n      render: false\n    }\n  }\n\n  // remove version modifier (anything after ! after network)\n  const onNetwork = fw.network.split('!')[0]\n\n  if (\n    onNetwork === 'p2wsh' ||\n    onNetwork === 'btc' ||\n    onNetwork === 'p2pkh' ||\n    onNetwork === 'p2wpkh' ||\n    onNetwork === 'p2sh'\n  ) {\n    return {\n      where: 'btc:',\n      what: (\n        fw.address\n      ),\n      link: (\n        'https://blockstream.info/address/' + fw.address\n      ),\n      render: true\n    }\n  }\n\n  if (\n    onNetwork === 'http' ||\n    onNetwork === 'https' ||\n    onNetwork === 'url' ||\n    onNetwork === 'web'\n  ) {\n    return {\n      where: 'https://',\n      what: fw.address,\n      link: 'https://' + fw.address,\n      render: true\n    }\n  }\n\n  if (onNetwork === 'twitter') {\n    return {\n      where: 'twitter.com/',\n      what: fw.address,\n      link: 'https://twitter.com/' + fw.address,\n      render: true\n    }\n  }\n\n  if (onNetwork === 'github') {\n    return {\n      where: 'github.com/',\n      what: fw.address,\n      link: 'https://github.com/' + fw.address,\n      render: true\n    }\n  }\n\n  if (onNetwork === 'youtube') {\n    return {\n      where: 'youtu.be/',\n      what: fw.address,\n      link: 'https://www.youtube.com/watch?v=' + fw.address,\n      render: true\n    }\n  }\n\n  // if unknown forward network, no link, and the rest is shown as is\n  return {\n    where: onNetwork,\n    what: fw.address,\n    link: undefined,\n    render: true\n  }\n}\n","import React, { useEffect, useRef } from 'react'\nimport { RoundButton } from './../general/RoundButton'\nimport { Store } from './../../store/'\nimport { searchAction, changeAliasAction } from './../../store/actions/'\nimport { SearchResults } from './../SearchResults'\nimport styles from './HomeContent.module.css'\n\nexport const HomeContent = (props: any): JSX.Element => {\n  const { state, dispatch } = React.useContext(Store)\n\n  // if page is loaded with #/id/:alias format\n  // this will change alias to that one\n  // then it will navigate to '/'\n  // and then it will do search with new alias\n  // http://localhost:3000/#/id/satoshi\n  const alias = props?.match?.params?.alias\n  if (alias) {\n    searchAction({...state, alias}, dispatch, props.history)\n  }\n\n  // is serach done\n  const isSearchDone = () => state.pageInfo.checkedLightSearch\n\n  // put the textarea (by ref) into focus on mount and move caret to end\n  const inputEl = useRef<HTMLTextAreaElement>(null)\n  useEffect(() => {\n    if (inputEl && inputEl.current) {\n      inputEl.current.selectionEnd = inputEl.current.value.length\n      inputEl.current.selectionStart = inputEl.current.value.length\n      inputEl.current.focus()\n    }\n  }, [])\n\n  return (\n    <>\n      <div className={\n        !isSearchDone()\n          ? [styles.lblMainTitle].join(' ')\n          : [styles.lblMainTitle, styles.lblMainTitleAfter].join(' ')\n      }>\n        <span>Bitcoin</span> Name System\n      </div>\n      <div className={\n        !isSearchDone()\n          ? styles.divSearch\n          : [styles.divSearch, styles.divSearchAfter].join(' ')\n      }>\n        <textarea\n          id=\"txtSearch\"\n          className={ styles.txtSearch }\n          cols={ 30 }\n          rows={ 1 }\n          spellCheck={ false }\n          value={ state.alias }\n          placeholder={ 'e.g. satoshi' }\n          ref={ inputEl }\n          onChange={ e => changeAliasAction(state, dispatch, e?.target?.value) }\n          onKeyPress={ e => { e.key === 'Enter' && searchAction(state, dispatch) } }\n        ></textarea>\n        <RoundButton\n          sizebutton='2.6'\n          onClick={ () => searchAction(state, dispatch) }\n        >\n          .btc\n        </RoundButton>\n      </div>\n      <div style={{ display: isSearchDone() ? 'block' : 'none' }}>\n        <SearchResults />\n      </div>\n    </>\n  )\n}\n","import React from 'react'\nimport { HomeContent } from './../components/HomeContent'\n\nconst Home = (props: any): JSX.Element => {\n  return (\n    <>\n      <HomeContent { ...props } />\n    </>\n  )\n}\nexport default Home","import React from 'react'\nimport { Store } from './../../store/'\nimport styles from './AboutContent.module.css'\n\nexport const AboutContent = () => {\n  const { state } = React.useContext(Store)\n\n  return (\n    <>\n      <div className={ styles.wrapper }>\n        <div>\n          About page (TODO)\n        </div>\n        <pre>\n          { JSON.stringify({ ...state }, null, 2) }\n        </pre>\n      </div>\n    </>\n  )\n}\n","import React from 'react'\nimport { AboutContent } from './../components/AboutContent'\n\nexport default function About(): JSX.Element {\n  return (\n    <>\n      <AboutContent />\n    </>\n  )\n}\n\n// for lazy loading:\n// const RoundButton = React.lazy<any>(() => import('../components/RoundButton')\n// <React.Suspense\n//   fallback={\n//     <div>loading...</div>\n//   }\n// >\n// </React.Suspense>\n","import React, { useState } from 'react'\nimport { RoundButton } from '../../general/RoundButton'\nimport styles from './P1RestoreOrBackup.module.css'\nimport { createNewWalletAction, changePageInfoAction } from '../../../store/actions/'\nimport sanitize from './../../../helpers/sanitize'\nimport { Store } from './../../../store/'\nimport { Details } from './../../general/Details'\n\nenum pages {\n  ROOT,\n  NEW_WALLET,\n  LOAD_BACKUP\n}\n\n// restore backup or create new\nexport const P1RestoreOrBackup = () => {\n  const { state, dispatch } = React.useContext(Store) // global state\n  const [ page, setPage ] = useState(pages.ROOT) // local state\n  const [ backup, setBackup ] = useState('') // local state\n\n  // count non empty string strings separated by spaces\n  const wordCount = backup.split(' ').filter(v => v !== '').length\n\n  return (\n    <div className={ styles.wrapper }>\n\n      {/* ROOT PAGE */}\n      <div\n        style={{ display: page === pages.ROOT ? 'block' : 'none' }}\n      >\n        <div\n          className={ styles.title }\n        >\n          { state.wallet.address ? (<>\n            Your <span className={ styles.Orange }>BTC</span> wallet for interacting<br />\n            with the domains\n          </>) : (<>\n            Need a <span className={ styles.Orange }>BTC</span> wallet for interacting<br />\n            with the domains\n          </>) }\n        </div>\n        <div>\n          <Details>\n            <p>\n              <span>This wallet has the built in functionality missing from other wallets to create transactions with custom scripts, inputs, and outputs necessary for this application.</span>\n\n              <span>The wallet's address is how users and owners of the domains are identified and should only be used for this purpose.</span>\n\n              <span>1. BIP39 mnemonic is used from backup or generated</span>\n              <span>2. BIP32 master seed is derived from the mnemonic</span>\n              <span>3. Key pair is derived from the m/44'/0'/0'/0/0 path</span>\n              <span>4. The p2wpkh (pay-to-witness-public-key-hash) address is derived from key pair</span>\n            </p>\n          </Details>\n        </div>\n        <div\n          className={ styles.buttonWrapper }\n        >\n          <RoundButton\n            show={ (state.wallet.mnemonic.length > 0) ? 'false' : 'true' }\n            onClick={() => {\n              setPage(pages.NEW_WALLET)\n              createNewWalletAction(state, dispatch)\n            }}\n          >\n            I need a new wallet\n          </RoundButton>\n          <RoundButton\n            show={ (state.wallet.mnemonic.length > 0) ? 'true' : 'false' }\n            onClick={() => {\n              setPage(pages.NEW_WALLET)\n            }}\n          >\n            Current backup\n          </RoundButton>\n          <RoundButton\n            onClick={() => {\n              setPage(pages.LOAD_BACKUP)\n            }}\n          >\n            Restore from backup\n          </RoundButton>\n          <RoundButton\n            show={ (!!state.wallet?.address).toString() }\n            onClick={() => {\n              changePageInfoAction(state, dispatch, 2)\n            }}\n            next='true'\n            colorbutton={'var(--colorHighlight)'}\n          >\n            Don't change wallet\n          </RoundButton>\n        </div>\n      </div>\n\n      {/* NEW_WALLET PAGE */ }\n\n      <div\n        className={ styles.contentWrapper }\n        style={{ display: page === pages.NEW_WALLET ? 'flex' : 'none' }}\n      >\n        <div className={ styles.describe }>\n          Randomly generated for domain control\n          <br /><br />\n          Backup this private phrase\n          or you will lose access\n        </div>\n        <div\n          id='divBackup'\n          spellCheck={ false }\n          className={ [styles.backup, 'selectable'].join(' ') }\n          onClick={ () => {\n            // select div entire contents\n            // const thisDiv = document?.getElementById('divBackup')\n            // if (thisDiv) {\n            //   window.getSelection()?.selectAllChildren(thisDiv)\n            // }\n          }}\n        >\n          { state.wallet.mnemonic }\n        </div>\n        <div className={ styles.buttonWrapper } >\n          <RoundButton\n            onClick={() => {\n              setPage(pages.ROOT)\n            }}\n            back='true'\n          >\n            Back\n          </RoundButton>\n          <RoundButton\n            onClick={() => {\n              setPage(pages.NEW_WALLET)\n              createNewWalletAction(state, dispatch)\n            }}\n          >\n            New\n          </RoundButton>\n          <RoundButton\n            next='true'\n            onClick={() => {\n              changePageInfoAction(state, dispatch, 2)\n            }}\n          >\n            I'm done with backup\n          </RoundButton>\n        </div>\n      </div>\n\n      {/* LOAD_BACKUP PAGE */ }\n\n      <div\n        style={{ display: page === pages.LOAD_BACKUP ? 'block' : 'none' }}\n      >\n        <div className={ styles.title }>\n          Type or paste your backup here\n        </div>\n        <br></br>\n        <div>\n          { (wordCount).toString() + ' words now. 12 minimum.' }\n        </div>\n        <br></br>\n        <textarea\n          className={ styles.restoreBackup }\n          cols={ 30 }\n          rows={ 3 }\n          spellCheck={ false }\n          placeholder={ 'mnemonic backup' }\n          onChange={ e => {\n            // lowcaps, spaces, single space max, only one space on left while typing\n            const cleanString = sanitize(\n              e.target.value.toLowerCase(),\n              'lowcaps spaces single_space_width'.split(' ')\n            ).trimLeft()\n            setBackup(cleanString.trim()) // store without trailing space\n            e.target.value = cleanString // quick update\n          } }\n        ></textarea>\n        <div className={ styles.buttonWrapper } >\n          <RoundButton\n            onClick={() => {\n              setPage(pages.ROOT)\n            }}\n            back='true'\n          >\n            Back\n          </RoundButton>\n          <RoundButton\n            // 12 words minimum separated by spaces (TODO): proper checks\n            show={ (wordCount >= 12) ? 'true' : 'false' }\n            next='true'\n            onClick={() => {\n              createNewWalletAction(state, dispatch, backup)\n              changePageInfoAction(state, dispatch, 2)\n            }}\n          >\n            Done\n          </RoundButton>\n        </div>\n      </div>\n    </div>\n  )\n}\n\n","import React, { useEffect, useState } from 'react'\nimport styles from './CreateHeader.module.css'\nimport { Store } from './../../../store/'\n\n// restore backup or create new\nexport const CreateHeader = () => {\n  const { state } = React.useContext(Store) // global state\n\n  // Make sure entire alias is always visible on top through\n  // resizing based on letter count.\n  //\n  // get window width in component instance state 'width'\n  // so can resize alias based on char count\n  const [ width, setWidth ] = useState(window.innerWidth)\n  useEffect(() => {\n    const resize = () => { setWidth(window.innerWidth) }\n    window.addEventListener('resize', resize);\n    return () => window.removeEventListener('resize', resize);\n  }, [])\n  const domainName = state.alias + state.extension\n  // enforces max size to font size so 1 letter alias has same font as 19 letter alias\n  const fontScale = Math.min(\n      Math.floor(1.1 * width / domainName.length),\n      Math.floor(1.1 * width / 15)\n  )\n\n  const barHeight = { height: (0.12 * width + 0.4 * fontScale).toString() + 'px' }\n  const aliasMarginTop = { marginTop: (0.02 * width - 0.1 * fontScale).toString() + 'px' }\n  const aliasFontSize = { fontSize: fontScale.toString() + 'px' }\n\n  return (\n    <>\n      <div\n        className={ styles.cutOverflow }\n        style={ barHeight }\n      >\n        <div\n          className={ styles.bar }\n          style={ barHeight }\n        />\n      </div>\n      <div\n        className={ styles.wrapper }\n        style={ aliasMarginTop }\n      >\n        <span\n          className={ styles.alias }\n          style={ aliasFontSize }\n        >{ state.alias }</span>\n        <span\n          className={ styles.ext }\n          style={ aliasFontSize }\n        >{ state.extension }</span>\n      </div>\n      <div className={ styles.spacer } />\n    </>\n  )\n}\n\n","import React from 'react'\nimport styles from './Details.module.css'\n\n/**\n * Create details expanding/collapsing button.\n * Optional props:\n * title={ 'random text' } to change text shown on the hide/show toggle button\n * show={ 'true } to show initially *\n * Background is automatically styled if <p></p> is used directly inside.\n * If so, <span></span> can be used inside <p></p> to separate\n * paragraphs and indent the wrap as well.\n */\nexport const Details = (props: any) => {\n  // local state for showing or hiding details\n  const [ showDetails, setShowDetails ] = React.useState(props?.show === 'true' || false)\n\n  return (\n    <div className={ styles.wrapper }>\n      {/* button that toggles whether details are shown or not */}\n      <div\n        className={ styles.toggleDetails }\n        onClick={ () => {\n          setShowDetails(!showDetails)\n        } }\n      >\n        {/* the text on button coems from title prop */}\n        { props.title || props.description || 'Show details' }\n        {/* the arrow that rotates on click */}\n        <div\n          className={ [styles.arrow, showDetails ? styles.down : '' ].join(' ') }\n        />\n      </div>\n      {/* the details that is rendered when showDetails = true */}\n      <div\n        className={ styles.details }\n        style={ {\n          display: (\n            showDetails ? 'block' : 'none'\n          )\n        } }\n      >\n        {/* any arbitrary content surrounded by this component brackets */}\n        {/* if <p></p> tags are used, they will be formated */}\n        { props.children }\n      </div>\n    </div>\n  )\n}\n","import React, { useState, useEffect } from 'react'\nimport { RoundButton } from '../../general/RoundButton'\nimport styles from './P2LoadWallet.module.css'\nimport { Store } from '../../../store'\nimport { changePageInfoAction } from '../../../store/actions'\nimport qr from 'qrcode'\n\n/**\n * Load wallet page, including faucet link for testnet users\n */\nexport const P2LoadWallet = () => {\n  const { state, dispatch } = React.useContext(Store) // global state\n\n  // load QR code into local state\n  const [ qrCode, setQrCode] = useState()\n  useEffect(() => {\n    qr.toDataURL(state.wallet.address, { type: 'image/jpeg' }, (err: any, url: any) => {\n      if (!err) { setQrCode(url) }\n    })\n  }, [state.wallet.address])\n\n  return (\n    <div className={ styles.wrapper }>\n      <div className={ styles.contentWrapper }>\n        <div\n          className={ styles.imgQr }\n        >\n          {/* downloadable */}\n          <img src={qrCode} alt={'QR Code'} />\n        </div>\n        <div>\n          Fund your wallet to interact with domains.\n        </div>\n        <div className={ [styles.address, 'selectable'].join(' ') }>\n          { state.wallet.address }\n        </div>\n      </div>\n      <div className={ styles.buttonWrapper }>\n        <RoundButton\n          back='true'\n          onClick={ () => {\n            changePageInfoAction(state, dispatch, 1)\n          }}\n        >\n          Back\n        </RoundButton>\n        <RoundButton\n          colorbutton={'var(--colorHighlight)'}\n          show={ (state.network === 'testnet').toString() }\n          onClick={ () => {\n            // open faucet page in new window\n            // segwit compatible:\n            // 1) https://testnet-faucet.mempool.co/\n            // 2) https://bitcoinfaucet.uo1.net/\n            window.open('https://bitcoinfaucet.uo1.net/', '_blank')\n            // window.open('https://testnet-faucet.mempool.co/', '_blank')\n          }}\n        >\n          Testnet: tBTC faucet\n        </RoundButton>\n        <RoundButton\n          onClick={ () => {\n            // open blockstream explorer for address in new window/tab\n            const pathEdit = (state.network === 'testnet') ? 'testnet/' : ''\n            window.open(\n              `https://blockstream.info/${pathEdit}address/${state.wallet.address}`\n            , '_blank')\n          }}\n        >\n          Open explorer\n        </RoundButton>\n        <RoundButton\n          next='true'\n          onClick={ () => {\n            changePageInfoAction(state, dispatch, 3)\n          }}\n        >\n          Ready\n        </RoundButton>\n      </div>\n    </div>\n  )\n}\n\n","import React from 'react'\nimport { RoundButton } from '../../general/RoundButton'\nimport styles from './P3DomainAndWallet.module.css'\nimport { Store } from '../../../store'\nimport { changePageInfoAction } from '../../../store/actions'\nimport { scanAddressFullyAction } from './../../../store/actions'\nimport { ActionTypes } from './../../../interfaces'\nimport { getUnspentSum } from '../../../helpers/bns/bitcoin'\n\n/**\n * Bid on network\n */\nexport const P3DomainAndWallet = () => {\n  const { state, dispatch } = React.useContext(Store) // global state\n\n  // Local state: keep track if API is busy\n  const [ apiStatus, setApiStatus ] = React.useState('ok')\n\n  // on state update detected by timestamp, reset api status\n  React.useEffect(() => { setApiStatus('ok') }, [ state.lastTimeStamp ])\n\n  // most important for domain notificaiton address is the transaction history to know ownership\n  // but also the current utxo in case we want to control the domain\n  const domainInfo = () => {\n    if (state.pageInfo.checkedDomain) {\n      return ('')\n    } else {\n      return ('needs scan')\n    }\n  }\n\n  // wallet needs utxo info including raw tx & tx history for nonce\n  const walletInfo = () => {\n    if (state.pageInfo.checkedWallet) {\n      return ( '' )\n    } else {\n      return ('needs scan')\n    }\n  }\n\n  // Conditions to enable next pages.\n  const readyStatus = () => {\n    if (!state.pageInfo.checkedDomain && !state.pageInfo.checkedWallet) {\n      return { isReady: false,    info: 'Scan both to move on' }\n    }\n    if (!state.pageInfo.checkedDomain && state.pageInfo.checkedWallet) {\n      return { isReady: false,    info: 'Scan domain to move on' }\n    }\n    if (state.pageInfo.checkedDomain && !state.pageInfo.checkedWallet) {\n      return { isReady: false,    info: 'Scan wallet to move on' }\n    }\n    if (state.pageInfo.checkedDomain && state.pageInfo.checkedWallet) {\n      return { isReady: true,     info: '' }\n    }\n    return { isReady: false,      info: 'Unknown status' }\n  }\n\n  return (\n    <div className={ styles.wrapper }>\n      <div className={ styles.title }>\n        Wallet and domain history needed. <br />\n        (No offline method yet)\n      </div>\n      <div className={ styles.domainInfo }>\n        { (apiStatus !== 'domain')  && 'Domain ' + domainInfo() }\n        { (apiStatus === 'domain')  && 'Domain scanning...' }\n      </div>\n      <div className={ styles.domainButton }>\n        <RoundButton\n          onClick={ () => {\n            if (apiStatus === 'ok') {\n              setApiStatus('domain')\n              scanAddressFullyAction(state, dispatch, ActionTypes.UPDATE_DOMAIN)\n            }\n          }}\n        >\n          API Scan\n        </RoundButton>\n      </div>\n      <div className={ styles.walletInfo }>\n        { (apiStatus !== 'wallet')  && 'Wallet ' + walletInfo() }\n        { (apiStatus === 'wallet') && 'Wallet scanning...' }\n      </div>\n      <div className={ styles.walletButton }>\n        <RoundButton\n          onClick={ () => {\n            if (apiStatus === 'ok') {\n              setApiStatus('wallet')\n              scanAddressFullyAction(state, dispatch, ActionTypes.UPDATE_WALLET)\n            }\n          }}\n        >\n          API Scan\n        </RoundButton>\n      </div>\n      <div className={ styles.unspent }>\n        <div className={ styles.balance }>\n          { state.pageInfo.checkedWallet? (getUnspentSum(state.wallet.utxoList) / 1e8).toFixed(8) : 'n/a' }\n        </div>\n        { (state.network === 'testnet') ? ' tBTC' : ' BTC' }\n      </div>\n      <div className={ styles.ownership }>\n        { readyStatus().info }\n      </div>\n      <div className={ styles.buttonWrapper }>\n        <RoundButton\n          back='true'\n          onClick={ () => {\n            changePageInfoAction(state, dispatch, 2)\n          }}\n        >\n          Back\n        </RoundButton>\n        <RoundButton\n          show={ readyStatus().isReady ? 'true' : 'false' }\n          next='true'\n          onClick={ () => {\n            changePageInfoAction(state, dispatch, 4)\n          }}\n        >\n          Ready\n        </RoundButton>\n      </div>\n    </div>\n  )\n}\n\n","import React from 'react'\nimport { RoundButton } from '../../general/RoundButton'\nimport styles from './P4ActionChoice.module.css'\nimport { Store } from '../../../store'\nimport { changePageInfoAction, changeChoicesBNSAction } from '../../../store/actions'\nimport { Details } from './../../general/Details'\nimport { runAllActionPermissionChecks, calcBnsState } from './../../../helpers/bns/'\n\n\n/**\n * Bid on network\n */\nexport const P4ActionChoice = () => {\n  // global state\n  const { state, dispatch } = React.useContext(Store)\n\n\n  // simulate bns state once again just in case\n  // up to current block height\n  const bns = calcBnsState(\n    state.domain.txHistory,\n    state.domain.domainName,\n    state.chain.height,\n    state.network\n  )\n  // and get all permissions\n  const checkActions = runAllActionPermissionChecks(bns, state.wallet.address)\n  console.log(checkActions)\n\n  // list available actions for render\n  const listAvailableActions = () => (\n    checkActions.map(action => {\n      // usable actions only + not displaying actions with warnings\n      if (action.isUsable && !action.warning) {\n        console.log(action.info, 'special tx instructions:', action.special)\n        return (\n        <RoundButton\n          next={ 'true' }\n          onClick={ () => {\n            changeChoicesBNSAction(state, dispatch, {\n              action: {\n                type: action.type,\n                info: action.info,\n                special: action.special\n              }\n            })\n            changePageInfoAction(state, dispatch, 5)\n          }}\n          key={ action.info }\n        >\n          { action.info }\n        </RoundButton>\n        )\n      } else {\n        return ''\n      }\n    })\n  )\n\n  // list unavailable actions for render\n  const listUnavailableActions = () => (\n    checkActions.map(action => {\n      if (!action.isUsable) {\n        return (\n          <div\n            className={\n              styles.unavailableActions__actionList__action\n            }\n            key={ action.info }\n          >\n            <div\n              className={\n                styles.unavailableActions__actionList__action__title\n              }\n            >\n              { action.info }\n            </div>\n            <div\n              className={\n                styles.unavailableActions__actionList__action__permissionList\n              }\n            >\n              { action.permissionList.map((permission: any) => {\n                return (\n                  <div\n                    className={\n                      styles.unavailableActions__actionList__action__permissionList__permission\n                    }\n                    key={permission.info}\n                  >\n                    - { permission.info }\n                  </div>\n                )\n              })}\n            </div>\n          </div>\n        )\n      } else {\n        return ('')\n      }\n    })\n  )\n\n  return (\n    <div className={ styles.wrapper }>\n      <div className={ styles.title }>\n        Available actions\n      </div>\n      <div className={ styles.availableActions }>\n        {\n          listAvailableActions()\n        }\n      </div>\n      <div className={ styles.unavailableActions }>\n        <Details\n          description={ 'Show unavailable actions' }\n          className= { styles.unavailableActions__title }\n        >\n          <div className={ styles.unavailableActions__actionList }>\n            {\n              listUnavailableActions()\n            }\n          </div>\n        </Details>\n      </div>\n      <div className={ styles.buttonWrapper }>\n        <RoundButton\n          back='true'\n          onClick={ () => {\n            changePageInfoAction(state, dispatch, 3)\n          }}\n        >\n          Back\n        </RoundButton>\n      </div>\n    </div>\n  )\n}","import React, { useEffect } from 'react'\nimport { RoundButton } from '../../general/RoundButton'\nimport { Details } from './../../general/Details'\nimport styles from './P5CustomForwards.module.css'\nimport { Store, getOwner } from '../../../store'\nimport { changePageInfoAction, changeChoicesBNSAction } from '../../../store/actions'\nimport { stringByteCount, BYTES_MAX, findLatestForwards } from '../../../helpers/bns'\nimport sanitize from '../../../helpers/sanitize'\n\ntype Planned_Changes = { [key: string]: string }\n\n/**\n * Edit custom forwards information.\n * state - global state.\n * textboxContent - text content inside the network and address textareas.\n */\nexport const P5CustomForwards = () => {\n  // global state\n  const { state, dispatch } = React.useContext(Store)\n\n  // object of planned changes derived from chosen string to embed\n  const plannedChanges = (\n    state.choices.embedString.split(' ').reduce((\n      plannedChangesSoFar: Planned_Changes,\n      word: string,\n      index: number,\n      words: Array<string>\n    ): Planned_Changes => {\n        if (index % 2 === 1) {\n          return { ...plannedChangesSoFar, [words[index - 1]]: word }\n        } else {\n          return plannedChangesSoFar\n        }\n      }\n    , {})\n  )\n\n  // change string to embed from an object of planned changes\n  const setPlannedChanges = (objForwards: Planned_Changes) => {\n    let forwardsString = ''\n    Object.keys(objForwards).forEach(fwNetwork => {\n      forwardsString += fwNetwork + ' ' + objForwards[fwNetwork] + ' '\n    })\n    if (forwardsString.length > 0) { forwardsString = forwardsString.slice(0, -1) }\n    console.log('string to embed:', '\"' + forwardsString + '\"')\n    changeChoicesBNSAction(state, dispatch, {\n      embedString: forwardsString\n    })\n  }\n\n  // array of past network:forwardingAddress objects\n  // display only active ones with latest higher\n  const pastForwards = findLatestForwards(getOwner(state)?.forwards || []).reverse()\n\n  // local state for content in textboxes for new network address changes\n  const [textboxContent, setTextboxContent] = React.useState({network: '', address: '' })\n\n  // combine forwards into a string to embed\n  const combineForwards = (objForwards: any) => {\n    let forwardsString = ''\n    Object.keys(objForwards).forEach(fwNetwork => {\n      forwardsString += fwNetwork + ' ' + objForwards[fwNetwork] + ' '\n    })\n    if (forwardsString.length > 0) { forwardsString = forwardsString.slice(0, -1) }\n    console.log('string to embed:', '\"' + forwardsString + '\"')\n    return forwardsString\n  }\n\n\n  useEffect(() => {\n\n  }, [])\n\n  const bytesOfChanges = stringByteCount(combineForwards(plannedChanges))\n  console.log(bytesOfChanges)\n\n  return (\n    <div className={ styles.wrapper }>\n      <div className={ styles.title }>\n        Update forwarding information\n        <div\n          className={ styles.subtitle }\n        >\n          Main action: { state.choices.action.info }\n        </div>\n      </div>\n      <div className={ styles.changes }>\n        {/* bytes info */ }\n        { (Object.keys(plannedChanges).length === 0) && 'No forwarding updates' }\n        { (bytesOfChanges <= BYTES_MAX) &&\n          <div className={ styles.bytesLeft }>\n            { BYTES_MAX - bytesOfChanges } Bytes left\n          </div>\n        }\n        { (bytesOfChanges > BYTES_MAX) &&\n          <div className={ styles.bytesOver }>\n            Too much by { bytesOfChanges - BYTES_MAX } Bytes\n          </div>\n        }\n        { Object.keys(plannedChanges).map((fwNetwork) => {\n          return (\n            <div\n              className={ styles.updateItem }\n              key={ fwNetwork }\n              onClick={ () => {\n                setTextboxContent({ network: fwNetwork, address: plannedChanges[fwNetwork] })\n              } }\n            >\n              <div\n                className={ styles.updateInfo }\n              >\n                {\n                  (plannedChanges[fwNetwork] !== '')\n                    ? (<>\n                      Updating forwarding on <span>{ ' ' + fwNetwork + ' ' }</span>\n                      network to address of <span>{ ' ' + plannedChanges[fwNetwork] + ' ' }</span>\n                      <i>{' '}(+{ stringByteCount(fwNetwork + ' ' + plannedChanges[fwNetwork]) }B)</i>\n                    </>)\n                    : (<>\n                      Deleting previously set forwarding information for\n                      <span>{ ' ' + fwNetwork + ' '}</span> network\n                      <i>{' '}(+{ stringByteCount(fwNetwork + ' ' + plannedChanges[fwNetwork]) }B)</i>\n                    </>)\n                }\n              </div>\n              <div\n                className={ ['btnCircle', styles.updateCancel, 'addTooltipRight'].join(' ') }\n                onClick={ (e) => {\n                  const newData = { ...plannedChanges }\n                  delete newData[fwNetwork]\n                  setPlannedChanges(newData)\n                  e.stopPropagation()\n                } }\n              >\n                <span></span>\n                <aside>Remove from planned changes</aside>\n              </div>\n            </div>\n          )\n        }) }\n      </div>\n      <div className={ styles.editor } >\n        { (textboxContent.network.length > 0) &&\n          <div\n            className={ [styles.btnDelete, 'canPress'].join(' ') }\n            onClick={ () => {\n              setPlannedChanges({\n                ...plannedChanges,\n                [textboxContent.network]: ''\n              })\n              setTextboxContent({ network: '', address: '' })\n            } }\n          >\n            No address\n          </div>\n        }\n        <div\n          className={ styles.editorNetwork }\n        >\n          <aside>Network</aside>\n          <textarea\n            spellCheck={ false }\n            value={ textboxContent.network }\n            placeholder={ 'e.g. btc' }\n            onChange={ (e) => {\n              const cleanText = sanitize(e.target.value, 'oneline')\n              setTextboxContent({ ...textboxContent, network: cleanText })\n              e.target.value = cleanText\n            } }\n          ></textarea>\n        </div>\n        <div\n          className={ styles.editorAddress }\n        >\n          <aside>Forwarding address</aside>\n          <textarea\n            spellCheck={ false }\n            value={ textboxContent.address }\n            placeholder={ 'e.g. your btc address' }\n            onChange={ (e) => {\n              const cleanText = sanitize(e.target.value, 'oneline')\n              setTextboxContent({ ...textboxContent, address: e.target.value })\n              e.target.value = cleanText\n            } }\n          ></textarea>\n        </div>\n        <div\n          className={ ['btnCircle', styles.btnAdd, 'canPress', 'addTooltip'].join(' ') }\n          onClick={ () => {\n            if (textboxContent.network !== '') {\n              setPlannedChanges({\n                ...plannedChanges,\n                [textboxContent.network]: textboxContent.address\n              })\n              setTextboxContent({ network: '', address: '' })\n            }\n          } }\n        >\n          <span>+</span>\n          <aside>Add to planned changes</aside>\n        </div>\n      </div>\n      <div className={ styles.pastList } >\n        <Details\n          description={ 'What\\'s this?' }\n        >\n          <p>\n            Enter the forwarding addresses you want to use (e.g. long bitcoin address) and specify on which network that address should be used (e.g. btc) when someone wants to reach you after looking up your domain alias.<br />\n            <br />\n            Submit new updates by hitting [+] button. Remove updates by hitting [x] buttons.<br />\n            <br />\n            Below, the currently active forwarding addresses are shown, if any.<br />\n            <br />\n            Edit them by reusing the exact same network or remove by setting forwarding address to nothing or hitting [no address] button under network name text.\n          </p>\n        </Details>\n        { pastForwards.map((fw: any, i: number) => {\n          return (\n            <div\n              className={ styles.pastPair }\n              key={ i }\n              onClick={ () => {\n                setTextboxContent({ network: fw.network, address: fw.address })\n              } }\n            >\n              <div className={ styles.pastNetwork } >\n                { fw.network }\n              </div>\n              <div className={ styles.pastAddress } >\n                { fw.address }\n              </div>\n            </div>\n          )\n        }) }\n      </div>\n      <div className={ styles.buttonWrapper }>\n        <RoundButton\n          back='true'\n          onClick={ () => {\n            changePageInfoAction(state, dispatch, 4)\n          }}\n        >\n          Back\n        </RoundButton>\n        <RoundButton\n          next='true'\n          show={ bytesOfChanges > BYTES_MAX ? 'false' : 'true' }\n          onClick={ () => {\n            changePageInfoAction(state, dispatch, 6)\n          }}\n        >\n          Ready\n        </RoundButton>\n      </div>\n    </div>\n  )\n}\n\n","import React from 'react'\nimport { Store } from '../../../store'\nimport { RoundButton } from '../../general/RoundButton'\nimport styles from './P6Broadcast.module.css'\nimport { changeChoicesBNSAction, changePageInfoAction } from '../../../store/actions'\nimport { calcTx } from './../../../helpers/bns/'\nimport { txPush } from './../../../api/blockstream'\nimport sanitize from './../../../helpers/sanitize'\nimport { getFeeEstimates } from './../../../api/blockstream'\nimport { getUnspentSum } from '../../../helpers/bns/bitcoin'\nimport { Details } from './../../general/Details'\n\n/**\n * Broadcast tx page.\n * Fee selection.\n * Transaction summary/status. *\n */\nexport const P6Broadcast = () => {\n  // global state\n  const { state, dispatch } = React.useContext(Store)\n\n  // local state for fee rate text that can end on decimal\n  const [ feeText, setFeeText ] = React.useState(state.choices.feeRate)\n  const [ feeSuggestions, setFeeSuggestions ] = React.useState({\n    showSuggestions: false,\n    apiSuccess: false,\n    min20: 1,\n    min40: 1,\n    min60: 1,\n  })\n\n  // tx calculation\n  let tx: any;\n  let txIssue: string = ''\n  try {\n    tx = calcTx(\n      state.wallet,\n      state.domain,\n      state.choices,\n      state.network\n    )\n  } catch (e) { txIssue = e.message }\n\n  // summarize number of updates in the embeded string\n  const numberOfUpdates = (state\n    .choices\n    .embedString\n    .split(' ')\n    .reduce((countSoFar: number, word: string, index: number, words: Array<string>) =>\n      (index % 2 === 1) ? countSoFar + 1 : countSoFar\n    , 0)\n  )\n\n  // keep track of broadcast\n  const [ broadcastStatus, setBroadcastStatus ] = React.useState({\n    ok: false,\n    txid: '123',\n    reason: ''\n  })\n\n  // show BTC balance with styling and proper units based on network\n  const unitBTC = (state.network === 'testnet') ? ' tBTC ' : ' BTC '\n  const showBTC = (sats: number = 0): JSX.Element => (\n    <>\n      <span className={ styles.balance }>\n        { (sats / 1e8).toFixed(8) }\n      </span>\n      { unitBTC }\n    </>\n  )\n\n  // get new suggestions if never got them through api\n  // otherwise show previous\n  const tryFees = async () => {\n    if (!feeSuggestions.apiSuccess) {\n      try {\n        const apiSuggest = await getFeeEstimates(state.network)\n        setFeeSuggestions({\n          min20: apiSuggest['2'],\n          min40: apiSuggest['4'],\n          min60: apiSuggest['6'],\n          apiSuccess: true,\n          showSuggestions: true\n        })\n\n      } catch (e) {}\n    } else {\n      setFeeSuggestions({\n        ...feeSuggestions,\n        showSuggestions: true\n      })\n    }\n  }\n\n  const finalCost = tx ? (\n    // No point confusing user if the cost is negative.\n    // Possible with enough anyone-can-spend utxo found.\n    Math.max(tx.gatheredFromWallet - tx.change, 0)\n  ) : undefined\n\n  return (\n    <div className={ styles.wrapper }>\n      <div className={ styles.title }>\n        Finalize transaction details\n      </div>\n      <div className={ styles.fees }>\n        <div className={ styles.fees__rate }>\n          <aside>Fee rate (sat / vByte):</aside>\n          <textarea\n            spellCheck={ false }\n            value={ feeText }\n            placeholder={ 'e.g. 1.2' }\n            onChange={ (e) => {\n              const cleanText = sanitize(e.target.value, [\n                'numbers', 'decimal_point', 'no_leading_zeros'\n              ])\n              setFeeText(cleanText)\n              // 123. works in parseFloat and outputs 123 so safe\n              const cleanNumber = parseFloat(cleanText)\n              changeChoicesBNSAction(state, dispatch, { feeRate: cleanNumber })\n            } }\n          ></textarea>\n        </div>\n        <div className= { styles.fees__apicall }>\n          <RoundButton\n            onClick={ () => {\n              tryFees()\n            } }\n          >\n            Check online\n          </RoundButton>\n          { (feeSuggestions.showSuggestions) && (\n            <div className={ styles.fees__feeSelection }>\n              <div\n                className= { styles.fees__feeSelection__choice }\n                onClick={ () => {\n                  setFeeText(feeSuggestions.min20)\n                  changeChoicesBNSAction(state, dispatch, {\n                    feeRate: feeSuggestions.min20\n                  })\n                  setFeeSuggestions({...feeSuggestions, showSuggestions: false})\n                } }\n              >\n                { '< ' }20 min ( { feeSuggestions.min20.toFixed(3) } sat / vByte )\n              </div>\n              <div\n                className= { styles.fees__feeSelection__choice }\n                onClick={ () => {\n                  setFeeText(feeSuggestions.min40)\n                  changeChoicesBNSAction(state, dispatch, {\n                    feeRate: feeSuggestions.min40\n                  })\n                  setFeeSuggestions({...feeSuggestions, showSuggestions: false})\n                } }\n              >\n                { '< ' }40 min ( { feeSuggestions.min40.toFixed(3) } sat / vByte )\n              </div>\n              <div\n                className= { styles.fees__feeSelection__choice }\n                onClick={ () => {\n                  setFeeText(feeSuggestions.min60)\n                  changeChoicesBNSAction(state, dispatch, {\n                    feeRate: feeSuggestions.min60\n                  })\n                  setFeeSuggestions({...feeSuggestions, showSuggestions: false})\n                } }\n              >\n                { '< ' }60 min ( { feeSuggestions.min60.toFixed(3) } sat / vByte )\n              </div>\n            </div>\n          ) }\n        </div>\n      </div>\n      <div className={ styles.totalCost }>\n        { (!!tx) ? <>Your final cost: { showBTC(finalCost) }</> : ' ' }\n      </div>\n      <div className={ styles.txSummary }>\n        { (!!tx) && (\n          <>\n            <Details>\n              <table><tbody>\n                <tr>\n                  <td>Action:</td>\n                  <td>{ state.choices.action.info }</td>\n                </tr>\n                <tr>\n                  <td>Updates:</td>\n                  <td>{ numberOfUpdates }</td>\n                </tr>\n                <tr>\n                  <td>Wallet:</td>\n                  <td>\n                    <p>{ showBTC(getUnspentSum(state.wallet.utxoList)) } total\n                    across { state.wallet.utxoList.length } utxo</p>\n                  </td>\n                </tr>\n                <tr>\n                  <td>Inputs:</td>\n                  <td>\n                    <p>{ showBTC(tx.gatheredFromWallet) } from\n                    {' '}{ tx.nInputsFromWallet } wallet utxo</p>\n                    <p>{ showBTC(tx.gatheredFromOther) } from\n                    {' '}{ tx.nInputsFromOther } notification utxo</p>\n                    <p>{ showBTC(tx.totalGathered) } total</p>\n                  </td>\n                </tr>\n                <tr>\n                  <td>Outputs:</td>\n                  <td>\n                    <p>Burning { showBTC(tx.burnAmount) } at #0</p>\n                    <p>Sending { showBTC(tx.notifyAmount) } at #1</p>\n                    <p>Change of { showBTC(tx.change) } sent back at #2</p>\n                    <p>{ tx.nOutputs } total outputs</p>\n                  </td>\n                </tr>\n                <tr>\n                  <td>Miner fee:</td>\n                  <td>\n                    <p>{ showBTC(tx.fee) }{' '}\n                    ({(tx.fee / tx.valueNeeded * 100.0).toFixed(1)}%)</p>\n                  </td>\n                </tr>\n                <tr>\n                  <td>Size:</td>\n                  <td>{ tx.thisVirtualSize } vBytes</td>\n                </tr>\n                <tr>\n                  <td>Cost:</td>\n                  <td>\n                    <p>+ Transaction requires { showBTC(tx.valueNeeded) }</p>\n                    <p>- Using { showBTC(tx.gatheredFromOther) } from anyone-can-spend utxo</p>\n                  </td>\n                </tr>\n                <tr>\n                  <td>Net cost:</td>\n                  <td>{ showBTC(tx.gatheredFromWallet - tx.change) }</td>\n                </tr>\n              </tbody></table>\n            </Details>\n          </>\n        )}\n        { (!tx) && (\n          <div className={ styles.txSummary }>\n            calculation failed <br />\n            { txIssue }\n          </div>\n        ) }\n      </div>\n      <div className={ styles.status }>\n        {/* hex here later, only in console now */}\n        { (broadcastStatus.ok) ? (\n          <>\n            <div\n              className={ [styles.status__button, 'canPress'].join(' ') }\n              onClick={ () => {\n                const PATH = `https://blockstream.info/` +\n                `${ state.network === 'testnet' ? 'testnet/' : '' }tx/` +\n                `${ broadcastStatus.txid }`\n                window.open(PATH, '_blank')\n              } }\n            >\n              Success! Open in explorer\n            </div>\n          </>\n        ) : (broadcastStatus.reason.length > 0) ? (\n          <div className={ styles.status__failed }>\n            { broadcastStatus.reason }\n          </div>\n        ) : ''\n      }\n      </div>\n      <div className={ styles.buttonWrapper }>\n        <RoundButton\n          back={ 'true' }\n          onClick={ () => { changePageInfoAction(state, dispatch, 5) } }\n        >\n          Back\n        </RoundButton>\n        <RoundButton\n          show={ tx?.hex !== '' ? 'true' : 'false' }\n          onClick={ async () => {\n            try {\n              const res = await txPush(tx.hex, state.network)\n              setBroadcastStatus({ok: true, txid: res.txid, reason: '' })\n            } catch (e) {\n              setBroadcastStatus({ok: false, txid: '', reason: e.message })\n            }\n          } }\n        >\n          Broadcast\n        </RoundButton>\n      </div>\n\n    </div>\n  )\n}","import React from 'react'\nimport { Store } from './../../store/'\nimport { CreateHeader } from './../CreateSteps/CreateHeader'\nimport { P1RestoreOrBackup } from '../CreateSteps/P1RestoreOrBackup'\nimport { P2LoadWallet } from '../CreateSteps/P2LoadWallet'\nimport { P3DomainAndWallet } from '../CreateSteps/P3DomainAndWallet'\nimport { P4ActionChoice } from '../CreateSteps/P4ActionChoice'\nimport { P5CustomForwards } from '../CreateSteps/P5CustomForwards'\nimport { P6Broadcast } from './../CreateSteps/P6Broadcast'\nimport styles from './CreateNavigator.module.css'\n\n/**\n * Handle navigation of alias manipulation\n */\nexport const CreateNavigator = () => {\n  // global state\n  const { state } = React.useContext(Store)\n\n  const page = state.pageInfo?.current\n\n  !page && console.log('Unknown Page')\n\n  return (\n    <>\n      <CreateHeader />\n      <div className={ [styles.wrapper, 'scrollbar'].join(' ') }>\n        <div className={ styles.horizontalScaler } >\n          { (page === 1) && <P1RestoreOrBackup /> }\n          { (page === 2) && <P2LoadWallet /> }\n          { (page === 3) && <P3DomainAndWallet /> }\n          { (page === 4) && <P4ActionChoice /> }\n          { (page === 5) && <P5CustomForwards /> }\n          { (page === 6) && <P6Broadcast /> }\n        </div>\n      </div>\n    </>\n  )\n}\n","import React from 'react'\nimport { CreateNavigator } from './../components/CreateNavigator'\n\nexport default function Create () {\n  return (\n    <>\n      <CreateNavigator />\n    </>\n  )\n}\n","import React from 'react'\nimport { Store } from './../../store'\nimport { Link, useHistory } from 'react-router-dom'\nimport styles from './Navbar.module.css'\n\nexport const Navbar = (): JSX.Element => {\n  // global state\n  const { state } = React.useContext(Store)\n\n  const isCreatePage = useHistory().location.pathname === '/create'\n  const isHomePage = useHistory().location.pathname === '/'\n  const isAboutPage = useHistory().location.pathname === '/about'\n\n  return (\n    <>\n      <div\n        className={ styles.warning }\n      >\n        FOR TESTING, DO NOT USE\n      </div>\n      <div\n        className={ styles.root }\n      >\n        {/* only show page number in create path */}\n        { isCreatePage && (\n          <div className={ styles.pageNum }>\n            { state.pageInfo.current }/6\n          </div>\n        ) }\n        <a\n          href=\"https://github.com/ildarmgt/BitcoinNameSystem\"\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n        >\n          { 'source' }\n        </a>\n        <Link\n          className={ isAboutPage ? styles.selected : '' }\n          to='/about'\n        >about</Link>\n        <Link\n          className={ isCreatePage ? styles.selected : '' }\n          to='/create'\n        >owners</Link>\n        <Link\n          className={ isHomePage ? styles.selected : '' }\n          to='/'\n        >search</Link>\n      </div>\n    </>\n  )\n}\n\n// Hash history cannot PUSH the same path; a new entry will not be added to the history stack\n// Only issue is the warning in console, but that only exists in development mode so can be ignored.","import React from 'react';\nimport { Route, Switch } from 'react-router-dom'\nimport Home from './pages/Home'\nimport About from './pages/About'\nimport Create from './pages/Create'\nimport { Navbar } from './components/Navbar'\n\n// using for routing\nconst App = (): JSX.Element => {\n  // onbtc.me?satoshi can now forward to onbtc.me/#/id/satoshi which resets to onbtc.me after search\n  // redirect to auto searching path routed in return and remove query from url\n  const searchParam = (new URLSearchParams(window.location.search)).keys().next().value\n  searchParam && console.log('search param detected after ?', searchParam)\n  // no forward slash before # in string is vital\n  searchParam && window.history.pushState({}, '', window.location.pathname + '#/id/' + searchParam)\n\n  return (\n    <>\n      {/* switch only renders first match instead of all matches */}\n      <Switch>\n        <Route path='/id/:alias' component={Home} />\n        <Route exact path='/id/' component={Home} />\n        <Route path=\"/about\" component={About} />\n        <Route path=\"/create\" component={Create} />\n        <Route path='/:noise' component={Home} />\n        <Route exact path='/' component={Home} />\n      </Switch>\n      <Navbar />\n      {/* <Route exact path=\"/\" render={() => <Home />} /> */}\n    </>\n  );\n}\nexport default App;\n","import React, { useState, useEffect } from 'react'\nimport styles from './DevPanel.module.css'\nimport { Store } from '../../store/'\nimport { ActionTypes } from './../../interfaces/'\nconst json = require('./../../utils/test.json');\n\ninterface I_State {\n  blShow: boolean\n  setShow: React.Dispatch<React.SetStateAction<boolean>>\n}\n\nexport const DevPanel = (props: any): JSX.Element => {\n  const { state, dispatch } = React.useContext(Store) // global state\n\n  // store if DevPanel is hidden\n  const [hidden, setHidden] = useState<boolean>(false);\n\n  // reruns to reattach keyup event to toggle hidden class\n  useEffect(() => {\n    const onDevKey = (e: any) => {\n      if (e.key === '`') {\n        setHidden(!hidden)\n      } else {\n        // give focus back to the input bar\n        if (document.activeElement?.id !== 'txtSearch') {\n          const txtSearch = document.getElementById('txtSearch') as HTMLTextAreaElement\n          txtSearch?.focus()\n        }\n      }\n    }\n    document.addEventListener('keyup', onDevKey)\n    return () => {\n      document.removeEventListener('keyup', onDevKey)\n    }\n  }, [hidden])\n\n  const onOutlineClick = () => {\n    const id: string = 'outliner';\n    const sheet: HTMLElement | null = document.getElementById(id);\n    if (!sheet) {\n      const outlineCss = '* {box-shadow: 0 0 0 1px red;}'\n      const style = document.createElement('style')\n      style.type = 'text/css'\n      style.id = id\n      style.appendChild(document.createTextNode(outlineCss))\n      document.head.appendChild(style)\n    } else {\n      sheet.parentNode?.removeChild(sheet)\n    }\n  }\n\n  const dlState = () => {\n    let data = \"text/json;charset=utf-8,\" + encodeURIComponent(JSON.stringify(state))\n    let a = document.createElement('a')\n    a.href = 'data:' + data\n    a.download = 'test.json'\n    a.innerHTML = 'download JSON'\n    let container = document.getElementById('container')\n    container?.appendChild(a)\n    a.click()\n    a.remove()\n  }\n\n  return (\n    <div\n      className={[\n        styles.divDev,\n        !hidden ? styles.hidden : ''\n      ].join(' ')}\n      { ...props }\n    >\n      <div><b>DevPanel</b></div>\n      <div\n        className={ styles.button }\n        onClick={ () => {\n          dlState()\n        } }\n      >\n        Save State\n      </div>\n      <div\n        className={ [styles.btnOutline, styles.button].join(' ') }\n        onClick={ onOutlineClick }\n      >\n        Outline\n      </div>\n      <div\n        className={ styles.button }\n        onClick={ () => {\n          console.log(json);\n          dispatch({ type: ActionTypes.LOAD_STATE, payload: json });\n        } }\n      >\n        Load State\n      </div>\n      <div\n        className={ styles.button }\n        onClick={ () => {\n          console.log(state);\n        } }\n      >\n        Console State\n      </div>\n    </div>\n  )\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { HashRouter } from 'react-router-dom';\nimport './css/global.css';\nimport App from './App';\nimport { StoreProvider } from './store'\nimport { DevPanel } from './components/DevPanel'\n\n// Using for store access and hash router base\nReactDOM.render(\n  <StoreProvider>\n    <HashRouter>\n      <App />\n    </HashRouter>\n    <DevPanel />\n  </StoreProvider>,\n  document.getElementById('root')\n)\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\n// serviceWorker.register();\n// import * as serviceWorker from './serviceWorker';","// extracted by mini-css-extract-plugin\nmodule.exports = {\"lblMainTitle\":\"HomeContent_lblMainTitle__1LqCG\",\"lblMainTitleAfter\":\"HomeContent_lblMainTitleAfter__J9CsB\",\"divSearch\":\"HomeContent_divSearch__3dKw5\",\"divSearchAfter\":\"HomeContent_divSearchAfter__2MAMf\",\"txtSearch\":\"HomeContent_txtSearch__3HpSp\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"divDev\":\"DevPanel_divDev__2q66m\",\"hidden\":\"DevPanel_hidden__Wlj3v\",\"btnOutline\":\"DevPanel_btnOutline__2FJLx\",\"button\":\"DevPanel_button__1DKHt\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"roundButtonWrap\":\"RoundButton_roundButtonWrap__2X50a\",\"roundButton\":\"RoundButton_roundButton__tfjmf\",\"overhead\":\"RoundButton_overhead__As9JW\",\"nextArrow\":\"RoundButton_nextArrow__SS6Nl\",\"backArrow\":\"RoundButton_backArrow__2MJJm\",\"back\":\"RoundButton_back__3z3jD\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"cutOverflow\":\"CreateHeader_cutOverflow__3s_72\",\"bar\":\"CreateHeader_bar__27ge1\",\"wrapper\":\"CreateHeader_wrapper__3cPTN\",\"alias\":\"CreateHeader_alias__1dNdj\",\"ext\":\"CreateHeader_ext__17sc6\",\"spacer\":\"CreateHeader_spacer__3tstm\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"Navbar_root__2XES1\",\"warning\":\"Navbar_warning__1HOBZ\",\"pageNum\":\"Navbar_pageNum__1amUi\",\"selected\":\"Navbar_selected__10Mm9\"};","import * as bitcoin from 'bitcoinjs-lib'\nconst op = bitcoin.opcodes;\nconst hash160 = bitcoin.crypto.hash160;\n\n\n/**\n * Get p2wsh notificaiton address from domainName and network.\n * @param   {string} domainName         - full domainName to use (e.g. 'satoshi.btc').\n * @param   {string} networkChoice      - 'testnet' or 'bitcoin' (matches bitcoinjs-lib).\n * @returns {object}                    - { notificationsAddress - p2wsh address derived from domainName }.\n */\nexport const calcP2WSH = (domainName: string, networkChoice: string) => {\n  const network = bitcoin.networks[networkChoice];\n\n  // convert domainName into buffer so it can be put into script\n  const bufferData = Buffer.from(domainName, 'utf8');\n\n  // easily spendable script for ACS notification output\n  // specific to this domainName\n  const witnessScript = bitcoin.script.compile([\n    hash160(bufferData),\n    op.OP_DROP\n  ]);\n\n  // calculate p2wsh address for this witnessScript & network\n  const p2wsh = bitcoin.payments.p2wsh({\n    redeem: {\n      output: witnessScript,\n      network\n    },\n    network\n  })\n  const notificationsAddress = p2wsh.address;\n\n  return {\n    notificationsAddress\n  };\n}\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"Details_wrapper__32nmX\",\"toggleDetails\":\"Details_toggleDetails__2jgtb\",\"arrow\":\"Details_arrow__2N1IF\",\"down\":\"Details_down__2irBp\",\"details\":\"Details_details__1lwEd\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"P2LoadWallet_wrapper__vI_bb\",\"contentWrapper\":\"P2LoadWallet_contentWrapper__UNLo4\",\"buttonWrapper\":\"P2LoadWallet_buttonWrapper__1rrct\",\"address\":\"P2LoadWallet_address__37xx2\",\"imgQr\":\"P2LoadWallet_imgQr__3Avh3\"};","import { I_User, I_BnsState } from './types/'\n\n// Initializing values\n\nexport const newState: I_BnsState = {\n  domain: {                                     // notification info for this domain name\n    domainName:                   '',           // domain name\n    notificationAddress:          '',           // p2wsh address for this domain name (alias + extension)\n    txHistory:                    [],           // array of all tx for this address (old addressHistory)\n    derivedUtxoList:              [],           // derived utxo set from tx history parse\n    utxoList:                     [],           // array of all real time utxo at address\n    users:                        {},           // keeps track of interacting users / source addresses with addresses as keys\n    currentOwner:                 '',           // points to a source address or blank string\n    bidding:                      {},           // bidding\n    ownersHistory:                []            // owner history log\n  },\n  chain: {\n    parsedHeight:                 0,            // parsed height for derivation\n    currentHeight:                0             // real world block height\n  }\n}\n\n// values to initialize users with\nexport const newUser: I_User = {\n  address:        '',           // address in control\n  forwards:       [],           // for forwards later\n  burnAmount:     0,            // burned to get ownership\n  winHeight:      0,            // blockheight winning bid\n  winTimestamp:   0,            // winHeight in block's timestamp\n  nonce:          0,            // for counting previous notification height from this address, no matter good/bad/type\n  updateHeight:   0             // the height of most current parsed update, created after nonce height & therefore using it\n}\n"],"sourceRoot":""}